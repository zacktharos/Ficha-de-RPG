<!DOCTYPE html><html lang="pt-br"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Ficha de Personagem RPG</title><link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Inter:wght@400;600&display=swap" rel="stylesheet"><script src="https://unpkg.com/@tailwindcss/browser@4"></script><script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script><style>body{font-family:'Inter',sans-serif;background:#f5f5f5;color:#000;display:flex;min-height:100vh;margin:0;padding:20px;background-image:url('medieval_background.jpg');background-size:cover;background-position:center;transition:background 0.3s,color 0.3s}body.dark-mode{background:#121212;color:#e0e0e0}#fichas-sidebar{width:100%;height:60px;background:transparent;padding:10px 0;display:flex;flex-direction:row;align-items:center;justify-content:flex-start;position:fixed;top:0;left:0;box-shadow:0 2px 5px rgba(0,0,0,0.3);z-index:1000;overflow-x:auto}.ficha-tab{width:100px;height:50px;background:#f0e6d2;border:2px solid #b8860b;border-radius:10px 10px 0 0;margin-right:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background-color 0.3s ease,transform 0.2s ease;box-shadow:2px 2px 5px rgba(0,0,0,0.2)}.ficha-tab:hover{background:#a0522d;transform:translateY(-5px)}.ficha-tab.active{background:#a0522d;transform:translateY(-5px)}.ficha-tab span{font-family:'MedievalSharp',serif;color:#000;font-size:0.9rem;text-align:center;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#add-ficha-btn{width:100px;height:50px;background:#f0e6d2;border:2px solid #b8860b;border-radius:10px 10px 0 0;margin-right:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform 0.2s ease;box-shadow:0 0 10px #ffd700,0 0 20px #ffd700;z-index:1001}#add-ficha-btn span{font-family:'MedievalSharp',serif;color:#000;font-size:0.9rem}#add-ficha-btn:hover{background:#a0522d;transform:translateY(-5px)}#ficha-container{background:rgba(240,230,210,0.95);padding:30px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.2);width:95%;max-width:1200px;margin:80px auto 20px;border:2px solid #b8860b}body.dark-mode #ficha-container{background:rgba(30,30,30,0.95);color:#e0e0e0}h1#nome-personagem-titulo{font-family:'MedievalSharp',serif;color:#1C2526;font-size:3rem;margin-bottom:20px;text-align:center;text-shadow:1px 1px 2px rgba(0,0,0,0.1);animation:raios 2s infinite linear}@keyframes raios{0%{text-shadow:0 0 5px #FFD700,0 0 10px #FFD700,0 0 15px #FFD700,0 0 20px #FF4500}50%{text-shadow:0 0 10px #FFD700,0 0 15px #FFD700,0 0 20px #FF4500,0 0 25px #FF4500}100%{text-shadow:0 0 5px #FFD700,0 0 10px #FFD700,0 0 15px #FFD700,0 0 20px #FF4500}}section{background:#f0e6d2;border:2px solid #b8860b;border-radius:8px;padding:15px;margin-bottom:20px}section h2{text-align:center}body.dark-mode section{background:#1e1e1e;border-color:#444}label{font-weight:600;color:#000;margin-bottom:8px;display:block}body.dark-mode label{color:#e0e0e0}input[type="text"],input[type="number"],textarea{padding:10px;border:2px solid #b8860b;border-radius:6px;width:calc(100% - 24px);margin-bottom:15px;font-size:1rem;background:#fff;color:#000}body.dark-mode input[type="text"],body.dark-mode input[type="number"],body.dark-mode textarea{background:#333;color:#e0e0e0;border-color:#555}input[type="text"]:focus,input[type="number"]:focus,textarea:focus{border-color:#a0522d;outline:none;box-shadow:0 2px 5px rgba(0,0,0,0.1)}span[readonly]{padding:10px;border:2px solid #b8860b;border-radius:6px;width:calc(100% - 24px);margin-bottom:15px;font-size:1rem;background:#e8e8e8;cursor:pointer;display:inline-block}body.dark-mode span[readonly]{background:#444;border-color:#666}textarea{resize:vertical}.atributos-container{display:flex;justify-content:space-between;gap:20px}.atributos-coluna,.atributos-coluna-destaque{width:48%;display:flex;flex-direction:column;align-items:flex-start}.atributos-coluna-destaque{background:#fff;padding:10px;border-radius:6px;border:1px solid #b8860b}body.dark-mode .atributos-coluna-destaque{background:#333;border-color:#555}.atributo-destaque{padding:8px;margin-bottom:10px;display:flex;align-items:center;justify-content:space-between;width:100%}.atributo-destaque label{font-size:1.1rem;font-weight:700;color:#a0522d}.atributo-destaque span{font-size:1.2rem;font-family:'MedievalSharp',serif;color:#000}body.dark-mode .atributo-destaque span{color:#e0e0e0}.vida-magia-vigor{display:flex;justify-content:space-around;gap:15px;flex-wrap:wrap}.atributo-container{background:rgba(255,255,255,0.8);padding:12px;border-radius:8px;border:1px solid #b8860b;box-shadow:0 2px 4px rgba(0,0,0,0.1);width:30%;min-width:200px;text-align:center}body.dark-mode .atributo-container{background:rgba(50,50,50,0.8)}.atributo-container::before{font-size:1.5rem;margin-bottom:5px;display:block}.atributo-container.vida::before{content:"❤️"}.atributo-container.magia::before{content:"✨"}.atributo-container.vigor::before{content:"⚡"}.medieval-box{background:#f0e6d2;border:2px solid #b8860b;border-radius:8px;padding:10px;margin:5px 0;text-align:center}body.dark-mode .medieval-box{background:#1e1e1e;border-color:#444}.regeneracao{font-size:0.8rem;color:#555;margin-top:5px}body.dark-mode .regeneracao{color:#aaa}button{background:#b8860b;color:#fff;border:none;padding:5px 10px;cursor:pointer;font-size:1.2rem;border-radius:4px;margin:0 5px;transition:background-color 0.3s ease}body.dark-mode button{background:#555}button:hover{background:#a0522d}body.dark-mode button:hover{background:#777}.botoes-container{display:flex;justify-content:center;gap:10px;margin-top:20px}.botao{padding:12px 25px;border:none;border-radius:6px;font-size:1rem;cursor:pointer;transition:background-color 0.3s ease,transform 0.2s ease;font-family:'MedievalSharp',serif;color:#fff}.botao-reset{background:#b8860b}.botao-reset:hover{background:#a0522d;transform:translateY(-2px)}.botao-recomecar{background:#a52a2a}.botao-recomecar:hover{background:#8b0000;transform:translateY(-2px)}.botao-bloquear,.botao-desbloquear{background:#4a4a4a}.botao-bloquear:hover,.botao-desbloquear:hover{background:#2a2a2a;transform:translateY(-2px)}.botao-excluir{background:#a52a2a;position:absolute;bottom:20px;left:20px}.botao-excluir:hover{background:#8b0000;transform:translateY(-2px)}#nivel-container{text-align:center;margin-top:10px}#nivel{padding:10px;background:#f0e6d2;border:3px solid #000;border-radius:50%;width:100px;height:100px;display:flex;align-items:center;justify-content:center;font-size:3.125rem;box-shadow:inset 0 0 5px rgba(0,0,0,0.5);margin:0 auto}body.dark-mode #nivel{background:#1e1e1e;border-color:#444}.expandable-textarea{height:100px;width:100%;background:#fff;border:2px solid #b8860b;border-radius:6px;padding:10px;font-size:0.9rem}body.dark-mode .expandable-textarea{background:#333;color:#e0e0e0}#dice-container{position:absolute;top:20px;right:20px;width:200px;text-align:center;font-family:'MedievalSharp',serif;cursor:move;z-index:10;user-select:none}#dice-roll{width:100px;height:100px;background:#f0e6d2;border:2px solid #b8860b;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:2rem;cursor:pointer;margin:0 auto}body.dark-mode #dice-roll{background:#1e1e1e;border-color:#444}#dice-result{margin-top:10px;font-size:1rem;color:#000;display:none}body.dark-mode #dice-result{color:#e0e0e0}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:1000}.modal-content{background:#f0e6d2;padding:20px;border-radius:8px;border:2px solid #b8860b;box-shadow:0 4px 10px rgba(0,0,0,0.3);width:300px;text-align:center}body.dark-mode .modal-content{background:#1e1e1e;border-color:#444}.modal-content h3{font-family:'MedievalSharp',serif;color:#000;margin-bottom:15px}body.dark-mode .modal-content h3{color:#e0e0e0}.modal-content input{width:calc(100% - 20px);padding:10px;margin-bottom:15px;border:1px solid #ccc;border-radius:6px}body.dark-mode .modal-content input{background:#333;color:#e0e0e0;border-color:#555}.modal-content button{padding:10px 20px;border:none;border-radius:6px;font-family:'MedievalSharp',serif;color:#fff;cursor:pointer;margin:0 5px}.modal-content .confirm-btn{background:#b8860b}.modal-content .confirm-btn:hover{background:#a0522d}.modal-content .cancel-btn{background:#a52a2a}.modal-content .cancel-btn:hover{background:#8b0000}#vantagens-desvantagens-btn,#racas-btn,#classes-btn{padding:10px 20px;background:#f0e6d2;border:2px solid #b8860b;border-radius:6px;font-family:'MedievalSharp',serif;font-size:1rem;color:#000;cursor:pointer}body.dark-mode #vantagens-desvantagens-btn,body.dark-mode #racas-btn,body.dark-mode #classes-btn{background:#1e1e1e;color:#e0e0e0}#vantagens-desvantagens-btn:hover,#racas-btn:hover,#classes-btn:hover{background:#a0522d;color:#fff}#vantagens-desvantagens-panel,#racas-panel,#classes-panel{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(240,230,210,0.95);padding:20px;overflow-y:auto;z-index:999;border:2px solid #b8860b}body.dark-mode #vantagens-desvantagens-panel,body.dark-mode #racas-panel,body.dark-mode #classes-panel{background:rgba(30,30,30,0.95)}#vantagens-desvantagens-panel h2,#racas-panel h2,#classes-panel h2{font-family:'MedievalSharp',serif;font-size:2rem;text-align:center;color:#a0522d;margin-bottom:20px}.vantagem-item,.desvantagem-item,.raca-item{padding:10px;margin:5px 0;background:#fff;border:1px solid #ccc;border-radius:6px;cursor:pointer}body.dark-mode .vantagem-item,body.dark-mode .desvantagem-item,body.dark-mode .raca-item{background:#333;border-color:#555}.vantagem-item:hover,.desvantagem-item:hover,.raca-item:hover{background:#f0e6d2}body.dark-mode .vantagem-item:hover,body.dark-mode .desvantagem-item:hover,body.dark-mode .raca-item:hover{background:#444}.vantagem-item.comprada,.raca-item.comprada{background:#ffcccc;color:#f00;cursor:default}.desvantagem-item.comprada{background:#ccffcc;color:#080;cursor:default}#salvar-vantagens-btn,#salvar-racas-btn,#fechar-pagina-btn,#fechar-racas-btn,#fechar-classes-btn{position:fixed;bottom:20px;padding:12px 25px;background:#a52a2a;color:#fff;border:none;border-radius:6px;font-family:'MedievalSharp',serif;font-size:1.2rem;cursor:pointer}#salvar-vantagens-btn,#salvar-racas-btn{right:250px;display:none;background:#000}#fechar-pagina-btn,#fechar-racas-btn,#fechar-classes-btn{right:20px}.list-display{background:#fff;border:2px solid #b8860b;border-radius:6px;padding:10px;min-height:100px;max-height:200px;overflow-y:auto}body.dark-mode .list-display{background:#333;border-color:#555}.list-item{cursor:pointer;margin-bottom:5px;padding:5px;border-bottom:1px solid #ccc}body.dark-mode .list-item{border-color:#555}.list-item:hover{background:#e0e0e0}body.dark-mode .list-item:hover{background:#444}.inventory-slot{display:flex;align-items:center;margin-bottom:10px}.inventory-slot input[type="text"]{flex-grow:1;margin-right:10px}.inventory-slot input[type="number"]{width:60px}.magias-container{max-height:300px;overflow-y:auto;border:2px solid #b8860b;border-radius:6px;padding:10px;background:#fff}body.dark-mode .magias-container{background:#333;border-color:#555}.magias-container input{margin-bottom:10px}#adicionar-magia-btn{background:#b8860b;color:#fff;padding:8px 16px;border-radius:6px;cursor:pointer;display:block;margin-top:10px}#adicionar-magia-btn:hover{background:#a0522d}.classe-raca-container{background:#f0e6d2;border:2px solid #b8860b;padding:10px;border-radius:6px;margin-top:10px}body.dark-mode .classe-raca-container{background:#1e1e1e;border-color:#444}.raca-item{margin-bottom:20px;padding:10px;background:#fff;border:2px solid #b8860b;border-radius:6px}.raca-item h3{font-family:'MedievalSharp',serif;font-size:1.5rem;color:#a0522d}.raca-item p{font-size:1rem;color:#000}body.dark-mode .raca-item{background:#333;border-color:#555}body.dark-mode .raca-item p{color:#e0e0e0}</style></head><body><div id="fichas-sidebar"><div id="add-ficha-btn"><span>+ Fichas</span></div></div><div id="ficha-container"><h1 id="nome-personagem-titulo">Ficha de Personagem</h1><div id="ficha-content"><section id="informacoes-basicas"><h2>Informações Básicas</h2><label for="nome-personagem">Nome do Personagem:</label><input type="text" id="nome-personagem" placeholder="Digite o nome do seu personagem"><label for="descricao-personagem">Descrição do Personagem:</label><textarea id="descricao-personagem" placeholder="Digite a descrição do seu personagem"></textarea><label>Raça:</label><span id="raca-nome" readonly onclick="excluirRaca()"></span></section><section id="recursos"><h2>Recursos</h2><div class="vida-magia-vigor"><div class="atributo-container vida"><h3>Vida</h3><div class="medieval-box"><span>Vida Total: </span><span id="vida-total" readonly>50</span></div><div class="medieval-box"><span>Vida Atual: </span><button onclick="diminuirVida()">▼</button><span id="vida-atual">50</span><button onclick="aumentarVida()">▲</button></div><div class="regeneracao"><span>Regeneração por turno: <span id="regeneracao-vida">0</span> (parado)</span></div></div><div class="atributo-container magia"><h3>Magia</h3><div class="medieval-box"><span>Magia Total: </span><span id="magia-total" readonly>20</span></div><div class="medieval-box"><span>Magia Atual: </span><button onclick="diminuirMagia()">▼</button><span id="magia-atual">20</span><button onclick="aumentarMagia()">▲</button></div><div class="regeneracao"><span>Regeneração por turno: <span id="regeneracao-magia">0</span></span></div></div><div class="atributo-container vigor"><h3>Vigor</h3><div class="medieval-box"><span>Vigor Total: </span><span id="vigor-total" readonly>10</span></div><div class="medieval-box"><span>Vigor Atual: </span><button onclick="diminuirVigor()">▼</button><span id="vigor-atual">10</span><button onclick="aumentarVigor()">▲</button></div><div class="regeneracao"><span>Regeneração por turno: <span id="regeneracao-vigor">0</span> (parado)</span></div></div></div></section><section id="atributos"><h2>Atributos</h2><div class="atributos-container"><div class="atributos-coluna"><div class="atributo"><label for="forca">Força:</label><input type="number" id="forca" value="0" min="0"></div><div class="atributo"><label for="destreza">Destreza:</label><input type="number" id="destreza" value="0" min="0"></div><div class="atributo"><label for="agilidade">Agilidade:</label><input type="number" id="agilidade" value="0" min="0"></div><div class="atributo"><label for="constituicao">Constituição:</label><input type="number" id="constituicao" value="0" min="0"></div><div class="atributo"><label for="inteligencia">Inteligência:</label><input type="number" id="inteligencia" value="0" min="0"></div></div><div class="atributos-coluna-destaque"><div class="atributo-destaque"><label>Ataque:</label><span id="ataque" readonly>0</span></div><div class="atributo-destaque"><label>Ataque Mágico:</label><span id="ataque-magico" readonly>0</span></div><div class="atributo-destaque"><label>Acerto:</label><span id="acerto" readonly>0</span></div><div class="atributo-destaque"><label>Esquiva:</label><span id="esquiva" readonly>0</span></div><div class="atributo-destaque"><label>RDF:</label><span id="rdf" readonly>0</span></div><div class="atributo-destaque"><label>RDM:</label><span id="rdm" readonly>0</span></div></div></div></section><section id="combate"><h2>Combate</h2><div class="armamento-container"><div class="armamento-coluna"><label>Armamento Mão Direita:</label><div class="flex items-center mb-2"><input type="text" id="arma-direita-nome" placeholder="Nome da Arma" class="mr-2"><span>Ataque </span><input type="number" id="arma-direita-ataque" value="0" class="w-20 mr-2"><span>Ataque Mágico </span><input type="number" id="arma-direita-ataque-magico" value="0" class="w-20"></div></div><div class="armamento-coluna"><label>Armamento Mão Esquerda:</label><div class="flex items-center"><input type="text" id="arma-esquerda-nome" placeholder="Nome РусскийArma" class="mr-2"><span>Ataque </span><input type="number" id="arma-esquerda-ataque" value="0" class="w-20 mr-2"><span>Ataque Mágico </span><input type="number" id="arma-esquerda-ataque-magico" value="0" class="w-20"></div></div></div></section><section id="inventario-habilidades"><h2>Inventário e Habilidades</h2><div class="flex gap-20"><div style="width:50%"><label>Inventário (Peso Total: <span id="peso-total">0</span> kg):</label><div id="inventario-slots"><div class="inventory-slot"><input type="text" placeholder="Item 1" class="inventory-item"><input type="number" min="0" value="0" class="inventory-weight"></div><div class="inventory-slot"><input type="text" placeholder="Item 2" class="inventory-item"><input type="number" min="0" value="0" class="inventory-weight"></div><div class="inventory-slot"><input type="text" placeholder="Item 3" class="inventory-item"><input type="number" min="0" value="0" class="inventory-weight"></div><div class="inventory-slot"><input type="text" placeholder="Item 4" class="inventory-item"><input type="number" min="0" value="0" class="inventory-weight"></div><div class="inventory-slot"><input type="text" placeholder="Item 5" class="inventory-item"><input type="number" min="0" value="0" class="inventory-weight"></div><div class="inventory-slot"><input type="text" placeholder="Item 6" class="inventory-item"><input type="number" min="0" value="0" class="inventory-weight"></div><div class="inventory-slot"><input type="text" placeholder="Item 7" class="inventory-item"><input type="number" min="0" value="0" class="inventory-weight"></div><div class="inventory-slot"><input type="text" placeholder="Item 8" class="inventory-item"><input type="number" min="0" value="0" class="inventory-weight"></div><div class="inventory-slot"><input type="text" placeholder="Item 9" class="inventory-item"><input type="number" min="0" value="0" class="inventory-weight"></div><div class="inventory-slot"><input type="text" placeholder="Item 10" class="inventory-item"><input type="number" min="0" value="0" class="inventory-weight"></div></div></div><div style="width:50%"><label>Magias e Habilidades:</label><div id="magias-list" class="magias-container"><input type="text" placeholder="Magia/Habilidade 1" class="magia-nome"><input type="text" placeholder="Magia/Habilidade 2" class="magia-nome"><input type="text" placeholder="Magia/Habilidade 3" class="magia-nome"><input type="text" placeholder="Magia/Habilidade 4" class="magia-nome"><input type="text" placeholder="Magia/Habilidade 5" class="magia-nome"><input type="text" placeholder="Magia/Habilidade 6" class="magia-nome"><input type="text" placeholder="Magia/Habilidade 7" class="magia-nome"><input type="text" placeholder="Magia/Habilidade 8" class="magia-nome"><input type="text" placeholder="Magia/Habilidade 9" class="magia-nome"><input type="text" placeholder="Magia/Habilidade 10" class="magia-nome"></div><button id="adicionar-magia-btn">Adicionar Magia</button></div></div><div class="mt-4"><label>Vantagens:</label><div id="vantagens-list-display" class="list-display"></div><label>Desvantagens:</label><div id="desvantagens-list-display" class="list-display"></div></div><div class="classe-raca-container"><label>Classe:</label><input type="text" id="classe-nome" placeholder="Nome da Classe"><textarea id="classe-descricao" placeholder="Descrição da Classe" class="expandable-textarea"></textarea><label>Descrição da Raça:</label><textarea id="raca-descricao" placeholder="Descrição da Raça" class="expandable-textarea"></textarea></div></section><section id="status"><h2>Status</h2><div class="flex gap-20"><div><label>Experiência:</label><input type="number" id="experiencia" value="0" min="0"><label>Pontos de Habilidade (PD):</label><span id="pontos-habilidade" readonly>25</span><label>Pontos de Vantagem (PH):</label><span id="pontos-vantagem" readonly>8</span></div></div><div id="nivel-container"><label>Nível:</label><span id="nivel">0</span></div></section><div style="display:flex;justify-content:center;gap:20px;margin-bottom:20px"><button id="vantagens-desvantagens-btn">Vantagens e Desvantagens</button><button id="racas-btn">Raças 🏰</button><button id="classes-btn">Classes ⚔️</button></div><div class="botoes-container"><button id="reset-pontos" class="botao botao-reset">Reiniciar Pontos</button><button id="recomecar" class="botao botao-recomecar">Recomeçar</button><button id="bloquear-ficha" class="botao botao-bloquear">Bloquear Ficha</button><button id="lua-btn" class="botao">🌙</button><button id="sol-btn" class="botao">☀️</button></div><button id="excluir-ficha" class="botao botao-excluir">Excluir Ficha</button></div></div><div id="dice-container"><label>Role seu dado:</label><div id="dice-roll">-</div><div id="dice-result"></div></div><div id="vantagens-desvantagens-panel"><h2>Vantagens e Desvantagens</h2><div>Pontos de Vantagem Temporários: <span id="ph-temp">0</span></div><div id="vantagens-list"></div><div id="desvantagens-list"></div><button id="salvar-vantagens-btn">SALVAR</button><button id="fechar-pagina-btn">Fechar Página</button></div><div id="racas-panel"><h2>Raças</h2><div id="racas-list"></div><button id="salvar-racas-btn">SALVAR</button><button id="fechar-racas-btn">Fechar Página</button></div><div id="classes-panel"><h2>Classes</h2><button id="fechar-classes-btn">Fechar Página</button></div><div id="nome-ficha-modal" class="modal"><div class="modal-content"><h3>Dê um Nome à Ficha</h3><input type="text" id="nome-ficha-input" placeholder="Nome da ficha" maxlength="20"><button class="confirm-btn" onclick="criarNovaFicha()">Confirmar</button><button class="cancel-btn" onclick="fecharModal('nome-ficha-modal')">Cancelar</button></div></div><div id="bloquear-ficha-modal" class="modal"><div class="modal-content"><h3>Ponha sua Senha de 4 Dígitos</h3><input type="password" id="senha-bloqueio-input" placeholder="Senha (4 dígitos)" maxlength="4"><button class="confirm-btn" onclick="bloquearFicha()">Confirmar</button><button class="cancel-btn" onclick="fecharModal('bloquear-ficha-modal')">Cancelar</button></div></div><div id="password-modal" class="modal"><div class="modal-content"><h3>Digite sua Senha</h3><input type="password" id="senha-desbloqueio-input" placeholder="Senha (4 dígitos)" maxlength="4"><button class="confirm-btn" onclick="desbloquearFicha()">Confirmar</button><button class="cancel-btn" onclick="cancelarDesbloqueio()">Cancelar</button></div></div><div id="confirmar-compra-modal" class="modal"><div class="modal-content"><h3>Tem certeza que quer comprar isso?</h3><button class="confirm-btn" id="confirmar-compra-btn">Sim</button><button class="cancel-btn" onclick="fecharModal('confirmar-compra-modal')">Não</button></div></div><div id="salvar-vantagens-modal" class="modal"><div class="modal-content"><h3>Se salvar, as alterações não poderão ser desfeitas.</h3><button class="confirm-btn" id="confirmar-salvar-vantagens-btn">OK</button><button class="cancel-btn" onclick="fecharModal('salvar-vantagens-modal')">Cancelar</button></div></div><div id="senha-gm-modal" class="modal"><div class="modal-content"><h3>Peça permissão ao GM</h3><input type="password" id="senha-gm-input" placeholder="Senha GM"><button class="confirm-btn" id="confirmar-senha-gm-btn">Confirmar</button><button class="cancel-btn" onclick="fecharModal('senha-gm-modal')">Cancelar</button></div></div><script>const firebaseConfig={apiKey:"AIzaSyBbbwbwPXv6gztkyP3TXK-DtooEI7FcClI",authDomain:"ficha-de-rpg-b9685.firebaseapp.com",databaseURL:"https://ficha-de-rpg-b9685-default-rtdb.firebaseio.com",projectId:"ficha-de-rpg-b9685",storageBucket:"ficha-de-rpg-b9685.firebasestorage.app",messagingSenderId:"528610398062",appId:"1:528610398062:web:8fdb9cfd5ded8167613b7f"};firebase.initializeApp(firebaseConfig);const database=firebase.database();let fichas={},currentFichaId=null,isFichaLocked=false,fichaPassword=null,isFichaUnlocked=false,senhaMatriz="1040",vantagensSelecionadas=[],desvantagensSelecionadas=[],tempVantagensSelecionadas=[],tempDesvantagensSelecionadas=[],racaSelecionada=null,tempRacaSelecionada=null,vidaTotal,vidaAtual,magiaTotal,magiaAtual,vigorTotal,vigorAtual,previousValues=new Map();const vantagensData=[{nome:"Maestria com Armas curtas (2)",custo:2,descricao:"Adiciona +1 em ataque, +1 em acerto com armas curtas."},{nome:"Maestria com armas pesadas (2)",custo:2,descricao:"Adiciona +2 em ataque com armas pesadas."},{nome:"Maestria com armas de longo alcance (2)",custo:2,descricao:"Adiciona +2 em acerto com armas de longo alcance."},{nome:"Furtar (2)",custo:2,descricao:"+4 em testes de furto."},{nome:"Lábia (2)",custo:2,descricao:"+5 em testes de lábia."},{nome:"Velejar (1)",custo:1,descricao:""},{nome:"Beleza (1)",custo:1,descricao:"Aumenta em +3 o teste em lábia, paquera e persuasão."},{nome:"Boa Fama (2)",custo:2,descricao:"Aumenta em +4 chance de descontos em armamentos, pousadas, alimentos, etc."},{nome:"Arremedo (2)",custo:2,descricao:"Capacidade de imitar qualquer som SIMPLES."},{nome:"Destemor (1)",custo:1,descricao:"Dificilmente é assustado por algo."},{nome:"Empatia (3)",custo:3,descricao:"Sensibilidade extraordinária em relação aos outras pessoas."},{nome:"Empatia com animais (1)",custo:1,descricao:"Pode compreender as motivações dos animais."},{nome:"Patrono (4)",custo:4,descricao:"Possui um mentor ou organização que pode oferecer ajuda."},{nome:"Reconhecimento Social (2)",custo:2,descricao:"É membro de um grupo muito respeitado, temido ou venerado."},{nome:"Riqueza (2)",custo:2,descricao:"Inicia com 20 moedas de ouro."},{nome:"Aptidão para magia (4)",custo:4,descricao:"Adiciona 15% a mais de dano e gasta 15% a menos de magia."},{nome:"Combo Físico (4)",custo:4,descricao:"Começa com 50km velocidade corrida, pulo de 3m altura e 9m distância.",restricao:"inicio"},{nome:"Nadar (1)",custo:1,descricao:""},{nome:"Escalar (2)",custo:2,descricao:""},{nome:"Segunda língua (1)",custo:1,descricao:"Fala mais um idioma."},{nome:"Paquerador (2)",custo:2,descricao:"Adiciona +4 em teste para paquera e persuasão envolvendo flerte."},{nome:"Senso de perigo (5)",custo:5,descricao:"Aviso do mestre sobre perigos graves."},{nome:"Acrobata (3)",custo:3,descricao:"Adiciona + fama ao lutar em público."},{nome:"Equilíbrio Perfeito (3)",custo:3,descricao:"Adiciona +8 em testes de equilíbrio."},{nome:"Tecnologia (2)",custo:2,descricao:"Pode inventar coisas e criar objetos improvisados."},{nome:"Poder Oculto (7)",custo:7,descricao:"Ativa com 10% de vida, aumenta atributos em 50%."},{nome:"Sobrevivência em floresta (2)",custo:2,descricao:"Facilidade para sobreviver na floresta."}],desvantagensData=[{nome:"Fobia (+2)",ganho:2,descricao:"Medo irracional de algo específico."},{nome:"Má Fama (+2)",ganho:2,descricao:"Mal visto pela sociedade."},{nome:"Alcoolismo (+2)",ganho:2,descricao:"Dependência de álcool."},{nome:"Altruísmo (+2)",ganho:2,descricao:"Se sacrifica por outros."},{nome:"Avareza (+2)",ganho:2,descricao:"Preocupação com riquezas."},{nome:"Bullying (+3)",ganho:3,descricao:"Gosta de caçoar e agredir."},{nome:"Circunspeção (+2)",ganho:2,descricao:"Entende tudo literalmente."},{nome:"Compulsões (+3)",ganho:3,descricao:"Vício que consome recursos."},{nome:"Covardia (+2)",ganho:2,descricao:"Evita riscos."},{nome:"Dependentes (+4)",ganho:4,descricao:"Alguém depende de você."},{nome:"Fúria (+2)",ganho:2,descricao:"Perde o controle facilmente."},{nome:"Honestidade (+3)",ganho:3,descricao:"Sempre fala a verdade."},{nome:"Impulsividade (+2)",ganho:2,descricao:"Age sem pensar."},{nome:"Luxúria (+2)",ganho:2,descricao:"Desejo incontrolável por romance."},{nome:"Magnetismo Sobrenatural (+2)",ganho:2,descricao:"Atrai eventos estranhos."},{nome:"No Limite (+4)",ganho:4,descricao:"Assume riscos irracionais."},{nome:"Teimosia (+1)",ganho:1,descricao:"Faz do seu jeito."},{nome:"Amnésia (+2)",ganho:2,descricao:"Esquece coisas importantes."}],racasData=[{nome:"Humano (3)",custo:3,descricao:"Versáteis e adaptáveis.",vantagens:["Explorador Nato: Cavalo superior, equipamentos e mapa.","Mestre das Profissões: Escolha entre ferreiro, costureiro ou arquiteto.","Rede de Influência: Contatos influentes.","Determinação Inabalável: Ignora desvantagem 1x por dia."]},{nome:"Elfo (4)",custo:4,descricao:"Sábios e mágicos.",vantagens:["Sabedoria Ancestral: Domina um conhecimento e +1 língua.","Visão Élfica Suprema: Enxerga no escuro e detecta intenções.","Escudo Mágico: Reduz efeitos mágicos em 50%."]},{nome:"Anão (4)",custo:4,descricao:"Resilientes e habilidosos.",vantagens:["Fortitude Indomável: Trabalha 3 dias sem fadiga.","Artesão: Minerador, forjador ou joalheiro.","Senhor das Profundezas: Nunca se perde no subsolo."]},{nome:"Orc (3)",custo:3,descricao:"Guerreiros ferozes.",vantagens:["Lenda entre Guerreiros: Inspira temor.","Resiliência Brutal: Luta até 0 PV.","Domínio da Intimidação: Força rendição.","Fúria Ancestral: 2x por dia dobra força."]},{nome:"Meio Animal (Selvagem) (4)",custo:4,descricao:"Instinto primal.",vantagens:["Sentidos Predatórios: Sentido aguçado.","Senhor dos Terrenos: Adaptação total.","Frenesi Instintivo: Velocidade e ataques 1x por dia."]}];const nivelData=[{nivel:0,xp:0,pd:25,ph:8},{nivel:1,xp:10,pd:31,ph:9},{nivel:2,xp:30,pd:37,ph:10},{nivel:3,xp:60,pd:43,ph:11},{nivel:4,xp:100,pd:49,ph:12},{nivel:5,xp:150,pd:55,ph:13},{nivel:6,xp:210,pd:61,ph:14},{nivel:7,xp:280,pd:67,ph:15},{nivel:8,xp:360,pd:73,ph:16},{nivel:9,xp:450,pd:79,ph:17},{nivel:10,xp:550,pd:85,ph:18},{nivel:11,xp:670,pd:91,ph:19},{nivel:12,xp:810,pd:97,ph:20},{nivel:13,xp:970,pd:103,ph:21},{nivel:14,xp:1150,pd:109,ph:22},{nivel:15,xp:1350,pd:115,ph:23},{nivel:16,xp:1570,pd:121,ph:24},{nivel:17,xp:1810,pd:127,ph:25},{nivel:18,xp:2070,pd:133,ph:26},{nivel:19,xp:2350,pd:139,ph:27},{nivel:20,xp:2650,pd:145,ph:28}];function criarFichaMatriz(){const fichaId="ficha-matriz",fichaMatriz={nomeFicha:"Matriz",nomePersonagem:"Personagem Matriz",descricaoPersonagem:"Ficha original",forca:"0",destreza:"0",agilidade:"0",inteligencia:"0",constituicao:"0",experiencia:"0",armaDireitaNome:"",armaDireitaAtaque:"0",armaDireitaAtaqueMagico:"0",armaEsquerdaNome:"",armaEsquerdaAtaque:"0",armaEsquerdaAtaqueMagico:"0",vantagens:"",magiasHabilidades:"",desvantagens:"",inventario:Array(10).fill({item:"",peso:"0"}),velocidadeCorrida:"25",alturaPulo:"1",distanciaPulo:"3",isLocked:true,password:senhaMatriz,imagem:null,anotacoes:"",classeNome:"",classeDescricao:"",racaNome:"",racaDescricao:"",racaSelecionada:""};database.ref("fichas/ficha-matriz").once("value",snapshot=>{if(snapshot.exists()){currentFichaId=fichaId;carregarFicha(fichaId);carregarFichas();}else{database.ref(`fichas/${fichaId}`).set(fichaMatriz).then(()=>{currentFichaId=fichaId;carregarFicha(fichaId);});}});}function carregarFichas(){database.ref("fichas").on("value",snapshot=>{fichas=snapshot.val()||{};if(fichas["ficha-matriz"])atualizarAbasFichas();else criarFichaMatriz();});}function atualizarAbasFichas(){const sidebar=document.getElementById("fichas-sidebar"),addBtn=document.getElementById("add-ficha-btn");while(sidebar.children.length>1)sidebar.removeChild(sidebar.children[0]);for(let fichaId in fichas){if(fichaId!=="ficha-matriz"){const tab=document.createElement("div");tab.className="ficha-tab";tab.innerHTML=`<span>${fichas[fichaId].nomeFicha||"Sem Nome"}</span>`;tab.dataset.fichaId=fichaId;if(fichaId===currentFichaId)tab.classList.add("active");tab.onclick=()=>{currentFichaId=fichaId;carregarFicha(fichaId);atualizarAbasFichas();};sidebar.insertBefore(tab,addBtn);}}}document.getElementById("add-ficha-btn").onclick=()=>{document.getElementById("nome-ficha-modal").style.display="flex";document.getElementById("nome-ficha-input").value="";};function criarNovaFicha(){const nomeFicha=document.getElementById("nome-ficha-input").value.trim();if(!nomeFicha)return alert("Dê um nome à ficha!");const novaFichaId=database.ref("fichas").push().key,novaFicha={nomeFicha,nomePersonagem:"",descricaoPersonagem:"",forca:"0",destreza:"0",agilidade:"0",inteligencia:"0",constituicao:"0",experiencia:"0",armaDireitaNome:"",armaDireitaAtaque:"0",armaDireitaAtaqueMagico:"0",armaEsquerdaNome:"",armaEsquerdaAtaque:"0",armaEsquerdaAtaqueMagico:"0",vantagens:"",magiasHabilidades:Array(10).fill("").join("\n"),desvantagens:"",inventario:Array(10).fill({item:"",peso:"0"}),velocidadeCorrida:"25",alturaPulo:"1",distanciaPulo:"3",isLocked:false,password:null,imagem:null,anotacoes:"",classeNome:"",classeDescricao:"",racaNome:"",racaDescricao:"",racaSelecionada:""};database.ref(`fichas/${novaFichaId}`).set(novaFicha).then(()=>{currentFichaId=novaFichaId;carregarFicha(novaFichaId);fecharModal("nome-ficha-modal");atualizarAbasFichas();});}function fecharModal(modalId){document.getElementById(modalId).style.display="none";}const nomePersonagemInput=document.getElementById("nome-personagem"),descricaoPersonagemInput=document.getElementById("descricao-personagem"),forcaInput=document.getElementById("forca"),destrezaInput=document.getElementById("destreza"),agilidadeInput=document.getElementById("agilidade"),inteligenciaInput=document.getElementById("inteligencia"),constituicaoInput=document.getElementById("constituicao"),ataqueSpan=document.getElementById("ataque"),ataqueMagicoSpan=document.getElementById("ataque-magico"),acertoSpan=document.getElementById("acerto"),esquivaSpan=document.getElementById("esquiva"),rdfSpan=document.getElementById("rdf"),rdmSpan=document.getElementById("rdm"),armaDireitaNomeInput=document.getElementById("arma-direita-nome"),armaDireitaAtaqueInput=document.getElementById("arma-direita-ataque"),armaDireitaAtaqueMagicoInput=document.getElementById("arma-direita-ataque-magico"),armaEsquerdaNomeInput=document.getElementById("arma-esquerda-nome"),armaEsquerdaAtaqueInput=document.getElementById("arma-esquerda-ataque"),armaEsquerdaAtaqueMagicoInput=document.getElementById("arma-esquerda-ataque-magico"),resetPontosButton=document.getElementById("reset-pontos"),recomecarButton=document.getElementById("recomecar"),bloquearFichaButton=document.getElementById("bloquear-ficha"),experienciaInput=document.getElementById("experiencia"),nivelSpan=document.getElementById("nivel"),pontosHabilidadeSpan=document.getElementById("pontos-habilidade"),pontosVantagemSpan=document.getElementById("pontos-vantagem"),velocidadeCorridaSpan=document.getElementById("velocidade-corrida"),alturaPuloSpan=document.getElementById("altura-pulo"),distanciaPuloSpan=document.getElementById("distancia-pulo"),vantagensListDisplay=document.getElementById("vantagens-list-display"),desvantagensListDisplay=document.getElementById("desvantagens-list-display"),inventarioSlots=document.getElementById("inventario-slots"),pesoTotalSpan=document.getElementById("peso-total"),diceRoll=document.getElementById("dice-roll"),diceResult=document.getElementById("dice-result"),vantagensDesvantagensBtn=document.getElementById("vantagens-desvantagens-btn"),vantagensDesvantagensPanel=document.getElementById("vantagens-desvantagens-panel"),vantagensList=document.getElementById("vantagens-list"),desvantagensList=document.getElementById("desvantagens-list"),salvarVantagensBtn=document.getElementById("salvar-vantagens-btn"),fecharPaginaBtn=document.getElementById("fechar-pagina-btn"),magiasList=document.getElementById("magias-list"),adicionarMagiaBtn=document.getElementById("adicionar-magia-btn"),racasBtn=document.getElementById("racas-btn"),classesBtn=document.getElementById("classes-btn"),racasPanel=document.getElementById("racas-panel"),classesPanel=document.getElementById("classes-panel"),fecharRacasBtn=document.getElementById("fechar-racas-btn"),fecharClassesBtn=document.getElementById("fechar-classes-btn"),classeNomeInput=document.getElementById("classe-nome"),classeDescricaoInput=document.getElementById("classe-descricao"),racaNomeInput=document.getElementById("raca-nome"),racaDescricaoInput=document.getElementById("raca-descricao"),luaBtn=document.getElementById("lua-btn"),solBtn=document.getElementById("sol-btn"),salvarRacasBtn=document.getElementById("salvar-racas-btn"),racasList=document.getElementById("racas-list"),atributosInputs=[forcaInput,destrezaInput,agilidadeInput,inteligenciaInput,constituicaoInput];let nivel=0,pontosHabilidadeTotal=25,pontosHabilidadeUsados=0,experiencia=0,vidaBase=50;function carregarFicha(fichaId){if(!fichas[fichaId])return;const ficha=fichas[fichaId];nomePersonagemInput.value=ficha.nomePersonagem||"";descricaoPersonagemInput.value=ficha.descricaoPersonagem||"";forcaInput.value=ficha.forca||"0";destrezaInput.value=ficha.destreza||"0";agilidadeInput.value=ficha.agilidade||"0";inteligenciaInput.value=ficha.inteligencia||"0";constituicaoInput.value=ficha.constituicao||"0";experienciaInput.value=ficha.experiencia||"0";armaDireitaNomeInput.value=ficha.armaDireitaNome||"";armaDireitaAtaqueInput.value=ficha.armaDireitaAtaque||"0";armaDireitaAtaqueMagicoInput.value=ficha.armaDireitaAtaqueMagico||"0";armaEsquerdaNomeInput.value=ficha.armaEsquerdaNome||"";armaEsquerdaAtaqueInput.value=ficha.armaEsquerdaAtaque||"0";armaEsquerdaAtaqueMagicoInput.value=ficha.armaEsquerdaAtaqueMagico||"0";velocidadeCorridaSpan.textContent=ficha.velocidadeCorrida||"25";alturaPuloSpan.textContent=ficha.alturaPulo||"1";distanciaPuloSpan.textContent=ficha.distanciaPulo||"3";isFichaLocked=ficha.isLocked||false;fichaPassword=ficha.password||null;isFichaUnlocked=false;vantagensSelecionadas=ficha.vantagens?ficha.vantagens.split("\n").filter(v=>v.trim()):[];desvantagensSelecionadas=ficha.desvantagens?ficha.desvantagens.split("\n").filter(d=>d.trim()):[];racaSelecionada=ficha.racaSelecionada||"";racaNomeInput.textContent=racaSelecionada.split(" (")[0];racaDescricaoInput.value=racasData.find(r=>r.nome===racaSelecionada)?.vantagens.join("\n\n")||"";vantagensListDisplay.innerHTML="";desvantagensListDisplay.innerHTML="";vantagensSelecionadas.forEach(v=>{const div=document.createElement("div");div.textContent=v;div.className="list-item";div.onclick=()=>removerVantagem(v);vantagensListDisplay.appendChild(div);});desvantagensSelecionadas.forEach(d=>{const div=document.createElement("div");div.textContent=d;div.className="list-item";div.onclick=()=>removerDesvantagem(d);desvantagensListDisplay.appendChild(div);});const inventario=ficha.inventario||Array(10).fill({item:"",peso:"0"});inventarioSlots.querySelectorAll(".inventory-slot").forEach((slot,i)=>{slot.querySelector(".inventory-item").value=inventario[i]?.item||"";slot.querySelector(".inventory-weight").value=inventario[i]?.peso||"0";});calcularPesoTotal();const magias=ficha.magiasHabilidades?ficha.magiasHabilidades.split("\n"):Array(10).fill("");magiasList.innerHTML="";magias.forEach((m,i)=>{const input=document.createElement("input");input.type="text";input.className="magia-nome";input.placeholder=`Magia/Habilidade ${i+1}`;input.value=m;magiasList.appendChild(input);});classeNomeInput.value=ficha.classeNome||"";classeDescricaoInput.value=ficha.classeDescricao||"";atualizarBotaoBloquear();atualizarVantagensDesvantagensPanel();atualizarRacasPanel();experiencia=parseInt(experienciaInput.value)||0;atualizarNivel();calcularAtributos();vidaAtual=vidaTotal;magiaAtual=magiaTotal;vigorAtual=vigorTotal;document.getElementById("vida-atual").textContent=vidaAtual;document.getElementById("magia-atual").textContent=magiaAtual;document.getElementById("vigor-atual").textContent=vigorAtual.toFixed(1);pontosVantagemSpan.textContent=getPontosVantagem();previousValues.clear();document.querySelectorAll('input[type="text"],input[type="number"],textarea').forEach(input=>previousValues.set(input,input.value));}function atualizarBotaoBloquear(){bloquearFichaButton.textContent=isFichaLocked?"Desbloquear Ficha":"Bloquear Ficha";bloquearFichaButton.classList.toggle("botao-bloquear",!isFichaLocked);bloquearFichaButton.classList.toggle("botao-desbloquear",isFichaLocked);}function salvarDados(){if(!currentFichaId||isFichaLocked&&!isFichaUnlocked)return abrirModalSenha();const inventario=Array.from(inventarioSlots.querySelectorAll(".inventory-slot")).map(slot=>({item:slot.querySelector(".inventory-item").value,peso:slot.querySelector(".inventory-weight").value})),magias=Array.from(magiasList.querySelectorAll(".magia-nome")).map(input=>input.value),dados={nomePersonagem:nomePersonagemInput.value,descricaoPersonagem:descricaoPersonagemInput.value,forca:forcaInput.value,destreza:destrezaInput.value,agilidade:agilidadeInput.value,inteligencia:inteligenciaInput.value,constituicao:constituicaoInput.value,experiencia:experienciaInput.value,armaDireitaNome:armaDireitaNomeInput.value,armaDireitaAtaque:armaDireitaAtaqueInput.value,armaDireitaAtaqueMagico:armaDireitaAtaqueMagicoInput.value,armaEsquerdaNome:armaEsquerdaNomeInput.value,armaEsquerdaAtaque:armaEsquerdaAtaqueInput.value,armaEsquerdaAtaqueMagico:armaEsquerdaAtaqueMagicoInput.value,vantagens:vantagensSelecionadas.join("\n"),magiasHabilidades:magias.join("\n"),desvantagens:desvantagensSelecionadas.join("\n"),inventario,velocidadeCorrida:velocidadeCorridaSpan.textContent,alturaPulo:alturaPuloSpan.textContent,distanciaPulo:distanciaPuloSpan.textContent,isLocked:isFichaLocked,password:fichaPassword,anotacoes:"",classeNome:classeNomeInput.value,classeDescricao:classeDescricaoInput.value,racaNome:racaNomeInput.textContent,racaDescricao:racaDescricaoInput.value,racaSelecionada:racaSelecionada};database.ref(`fichas/${currentFichaId}`).update(dados).then(()=>{previousValues.clear();document.querySelectorAll('input[type="text"],input[type="number"],textarea').forEach(input=>previousValues.set(input,input.value));});}function calcularNivel(exp){return nivelData.findLast(data=>exp>=data.xp)?.nivel||0;}function atualizarNivel(){nivel=calcularNivel(experiencia);nivelSpan.textContent=nivel;pontosHabilidadeTotal=nivelData[nivel].pd;pontosVantagemSpan.textContent=getPontosVantagem();calcularAtributos();}function getPontosVantagem(){let ph=nivelData[nivel].ph;vantagensSelecionadas.forEach(v=>ph-=vantagensData.find(d=>d.nome===v)?.custo||0);desvantagensSelecionadas.forEach(d=>ph+=desvantagensData.find(desv=>desv.nome===d)?.ganho||0);if(racaSelecionada)ph-=racasData.find(r=>r.nome===racaSelecionada)?.custo||0;return ph;}function calcularPontosVantagemTemp(){let ph=nivelData[nivel].ph;tempVantagensSelecionadas.forEach(v=>ph-=vantagensData.find(d=>d.nome===v)?.custo||0);tempDesvantagensSelecionadas.forEach(d=>ph+=desvantagensData.find(desv=>desv.nome===d)?.ganho||0);if(tempRacaSelecionada)ph-=racasData.find(r=>r.nome===tempRacaSelecionada)?.custo||0;return ph;}function aumentarVida(){if(vidaAtual<vidaTotal){vidaAtual++;document.getElementById("vida-atual").textContent=vidaAtual;salvarDados();}}function diminuirVida(){if(vidaAtual>0){vidaAtual--;document.getElementById("vida-atual").textContent=vidaAtual;salvarDados();}}function aumentarMagia(){if(magiaAtual<magiaTotal){magiaAtual++;document.getElementById("magia-atual").textContent=magiaAtual;salvarDados();}}function diminuirMagia(){if(magiaAtual>0){magiaAtual--;document.getElementById("magia-atual").textContent=magiaAtual;salvarDados();}}function aumentarVigor(){if(vigorAtual<vigorTotal){vigorAtual=Math.min(vigorAtual+0.1,vigorTotal);document.getElementById("vigor-atual").textContent=vigorAtual.toFixed(1);salvarDados();}}function diminuirVigor(){if(vigorAtual>0){vigorAtual=Math.max(vigorAtual-0.1,0);document.getElementById("vigor-atual").textContent=vigorAtual.toFixed(1);salvarDados();}}function calcularAtributos(){const forca=parseInt(forcaInput.value)||0,destreza=parseInt(destrezaInput.value)||0,agilidade=parseInt(agilidadeInput.value)||0,inteligencia=parseInt(inteligenciaInput.value)||0,constituicao=parseInt(constituicaoInput.value)||0,totalPontos=forca+destreza+agilidade+inteligencia+constituicao;if(totalPontos>pontosHabilidadeTotal){alert("Pontos de habilidade insuficientes!");forcaInput.value=previousValues.get(forcaInput)||"0";destrezaInput.value=previousValues.get(destrezaInput)||"0";agilidadeInput.value=previousValues.get(agilidadeInput)||"0";inteligenciaInput.value=previousValues.get(inteligenciaInput)||"0";constituicaoInput.value=previousValues.get(constituicaoInput)||"0";return;}pontosHabilidadeUsados=totalPontos;pontosHabilidadeSpan.textContent=pontosHabilidadeTotal-pontosHabilidadeUsados;let ataque=forca+Math.floor(destreza/5),acerto=Math.floor(destreza/3)+Math.floor(agilidade/10),esquiva=Math.floor(agilidade/3),rdf=Math.floor(forca/5),rdm=Math.floor(inteligencia/5),ataqueMagico=inteligencia,magiaBase=20+3*constituicao,vigorBase=10+0.4*constituicao;vidaBase=50+(constituicao*(3+Math.floor(forca/10)))+10*nivel;if(inteligencia>=10)magiaBase+=constituicao*Math.floor(inteligencia/10);ataque+=(parseInt(armaDireitaAtaqueInput.value)||0)+(parseInt(armaEsquerdaAtaqueInput.value)||0);ataqueMagico+=(parseInt(armaDireitaAtaqueMagicoInput.value)||0)+(parseInt(armaEsquerdaAtaqueMagicoInput.value)||0);const velocidadeBase=25+Math.floor(agilidade/3)*3,alturaPuloBase=1+Math.floor(forca/10),distanciaPuloBase=3+3*Math.min(Math.floor(forca/5),Math.floor(agilidade/5));let bonusVelocidade=vantagensSelecionadas.includes("Combo Físico (4)")?25:0,bonusAlturaPulo=vantagensSelecionadas.includes("Combo Físico (4)")?2:0,bonusDistanciaPulo=vantagensSelecionadas.includes("Combo Físico (4)")?6:0;velocidadeCorridaSpan.textContent=velocidadeBase+bonusVelocidade;alturaPuloSpan.textContent=alturaPuloBase+bonusAlturaPulo;distanciaPuloSpan.textContent=distanciaPuloBase+bonusDistanciaPulo;ataqueSpan.textContent=ataque;ataqueMagicoSpan.textContent=ataqueMagico;acertoSpan.textContent=acerto;esquivaSpan.textContent=esquiva;rdfSpan.textContent=rdf;rdmSpan.textContent=rdm;vidaTotal=Math.ceil(vidaBase);magiaTotal=Math.ceil(magiaBase);vigorTotal=parseFloat(vigorBase.toFixed(1));vidaAtual=vidaAtual===undefined?vidaTotal:Math.min(vidaAtual,vidaTotal);magiaAtual=magiaAtual===undefined?magiaTotal:Math.min(magiaAtual,magiaTotal);vigorAtual=vigorAtual===undefined?vigorTotal:Math.min(vigorAtual,vigorTotal);document.getElementById("vida-total").textContent=vidaTotal;document.getElementById("magia-total").textContent=magiaTotal;document.getElementById("vigor-total").textContent=vigorTotal.toFixed(1);document.getElementById("vida-atual").textContent=vidaAtual;document.getElementById("magia-atual").textContent=magiaAtual;document.getElementById("vigor-atual").textContent=vigorAtual.toFixed(1);document.getElementById("regeneracao-vida").textContent=(0.2*constituicao).toFixed(1);document.getElementById("regeneracao-magia").textContent=(0.8*constituicao).toFixed(1);document.getElementById("regeneracao-vigor").textContent=(0.4*constituicao).toFixed(1);}function resetarPontos(){if(isFichaLocked&&!isFichaUnlocked)return abrirModalSenha();if(confirm("Reiniciar os pontos? Necessita permissão do GM.")){document.getElementById("senha-gm-modal").style.display="flex";document.getElementById("senha-gm-input").value="";document.getElementById("confirmar-senha-gm-btn").onclick=()=>{if(document.getElementById("senha-gm-input").value===senhaMatriz){atributosInputs.forEach(input=>input.value=0);pontosHabilidadeUsados=0;pontosHabilidadeSpan.textContent=pontosHabilidadeTotal;velocidadeCorridaSpan.textContent="25";alturaPuloSpan.textContent="1";distanciaPuloSpan.textContent="3";calcularAtributos();pontosVantagemSpan.textContent=getPontosVantagem();salvarDados();fecharModal("senha-gm-modal");}else{alert("Senha do GM incorreta!");fecharModal("senha-gm-modal");}};}}function recomecarFicha(){if(confirm("Recomeçar a ficha? Todas as alterações serão perdidas.")){atributosInputs.forEach(input=>input.value=0);pontosHabilidadeUsados=0;pontosHabilidadeSpan.textContent=pontosHabilidadeTotal;velocidadeCorridaSpan.textContent="25";alturaPuloSpan.textContent="1";distanciaPuloSpan.textContent="3";nomePersonagemInput.value="";descricaoPersonagemInput.value="";experienciaInput.value=0;nivel=0;pontosHabilidadeTotal=nivelData[nivel].pd;pontosHabilidadeUsados=0;nivelSpan.textContent=nivel;pontosHabilidadeSpan.textContent=pontosHabilidadeTotal;vidaBase=50;armaDireitaNomeInput.value="";armaDireitaAtaqueInput.value="0";armaDireitaAtaqueMagicoInput.value="0";armaEsquerdaNomeInput.value="";armaEsquerdaAtaqueInput.value="0";armaEsquerdaAtaqueMagicoInput.value="0";magiasList.innerHTML="";for(let i=0;i<10;i++){const input=document.createElement("input");input.type="text";input.className="magia-nome";input.placeholder=`Magia/Habilidade ${i+1}`;magiasList.appendChild(input);}inventarioSlots.querySelectorAll(".inventory-slot").forEach(slot=>{slot.querySelector(".inventory-item").value="";slot.querySelector(".inventory-weight").value="0";});vantagensSelecionadas=[];desvantagensSelecionadas=[];racaSelecionada=null;vantagensListDisplay.innerHTML="";desvantagensListDisplay.innerHTML="";classeNomeInput.value="";classeDescricaoInput.value="";racaNomeInput.textContent="";racaDescricaoInput.value="";calcularAtributos();pontosVantagemSpan.textContent=getPontosVantagem();salvarDados();}}bloquearFichaButton.onclick=()=>{if(isFichaLocked)abrirModalSenha();else{document.getElementById("bloquear-ficha-modal").style.display="flex";document.getElementById("senha-bloqueio-input").value="";}};function bloquearFicha(){const senha=document.getElementById("senha-bloqueio-input").value;if(senha.length!==4||!/^\d{4}$/.test(senha))return alert("A senha deve ter 4 dígitos numéricos!");if(desvantagensSelecionadas.length>3)return alert("Máximo de 3 desvantagens!");isFichaLocked=true;fichaPassword=senha;database.ref(`fichas/${currentFichaId}`).update({isLocked:true,password:senha}).then(()=>{fecharModal("bloquear-ficha-modal");alert("Ficha bloqueada!");atualizarBotaoBloquear();});}function abrirModalSenha(){document.getElementById("password-modal").style.display="flex";document.getElementById("senha-desbloqueio-input").value="";}function desbloquearFicha(){const senha=document.getElementById("senha-desbloqueio-input").value;if(senha!==senhaMatriz&&senha!==fichaPassword)return alert("Senha incorreta!");isFichaUnlocked=true;if(currentFichaId!=="ficha-matriz"&&senha!==senhaMatriz){database.ref(`fichas/${currentFichaId}`).update({isLocked:false,password:null}).then(()=>{fecharModal("password-modal");alert("Ficha desbloqueada permanentemente!");atualizarBotaoBloquear();});}else{fecharModal("password-modal");alert("Ficha desbloqueada temporariamente!");}}function cancelarDesbloqueio(){fecharModal("password-modal");}function verificarAlteracao(event){const input=event.target;if(isFichaLocked&&!isFichaUnlocked){event.preventDefault();previousValues.set(input,input.value);abrirModalSenha(input);}else previousValues.set(input,input.value);}document.querySelectorAll('input[type="text"],input[type="number"],textarea').forEach(input=>{input.addEventListener("beforeinput",verificarAlteracao);input.addEventListener("input",()=>{if(!isFichaLocked||isFichaUnlocked){if(input.id==="experiencia"){experiencia=parseInt(input.value)||0;atualizarNivel();}else if(atributosInputs.includes(input)){const totalPontos=(parseInt(forcaInput.value)||0)+(parseInt(destrezaInput.value)||0)+(parseInt(agilidadeInput.value)||0)+(parseInt(inteligenciaInput.value)||0)+(parseInt(constituicaoInput.value)||0);if(totalPontos>pontosHabilidadeTotal){alert("Pontos de habilidade insuficientes!");input.value=previousValues.get(input)||"0";return;}calcularAtributos();}else if(input.id.includes("arma"))calcularAtributos();salvarDados();}});});nomePersonagemInput.oninput=salvarDados;document.getElementById("excluir-ficha").onclick=()=>{if(currentFichaId==="ficha-matriz")return alert("A ficha matriz não pode ser excluída!");if(isFichaLocked&&!isFichaUnlocked)return abrirModalSenha();if(confirm("Excluir esta ficha?"))database.ref(`fichas/${currentFichaId}`).remove().then(()=>{currentFichaId="ficha-matriz";carregarFicha(currentFichaId);atualizarAbasFichas();});};diceRoll.onclick=()=>{if(isFichaLocked&&!isFichaUnlocked)return abrirModalSenha();diceRoll.textContent="Rolling...";diceResult.style.display="none";setTimeout(()=>{const roll=Math.floor(Math.random()*20)+1;diceRoll.textContent=roll;diceResult.textContent=`${fichas[currentFichaId].nomeFicha||"Sem Nome"} rolou: ${roll}`;diceResult.style.display="block";},1000);};vantagensDesvantagensBtn.onclick=()=>{if(isFichaLocked&&!isFichaUnlocked)return abrirModalSenha();tempVantagensSelecionadas=[...vantagensSelecionadas];tempDesvantagensSelecionadas=[...desvantagensSelecionadas];vantagensDesvantagensPanel.style.display="block";salvarVantagensBtn.style.display="none";atualizarVantagensDesvantagensPanel();};fecharPaginaBtn.onclick=()=>{vantagensDesvantagensPanel.style.display="none";};salvarVantagensBtn.onclick=()=>{document.getElementById("salvar-vantagens-modal").style.display="flex";};document.getElementById("confirmar-salvar-vantagens-btn").onclick=()=>{if(tempDesvantagensSelecionadas.length>3)return alert("Máximo de 3 desvantagens!");vantagensSelecionadas=[...tempVantagensSelecionadas];desvantagensSelecionadas=[...tempDesvantagensSelecionadas];vantagensListDisplay.innerHTML="";desvantagensListDisplay.innerHTML="";vantagensSelecionadas.forEach(v=>{const div=document.createElement("div");div.textContent=v;div.className="list-item";div.onclick=()=>removerVantagem(v);vantagensListDisplay.appendChild(div);});desvantagensSelecionadas.forEach(d=>{const div=document.createElement("div");div.textContent=d;div.className="list-item";div.onclick=()=>removerDesvantagem(d);desvantagensListDisplay.appendChild(div);});pontosVantagemSpan.textContent=getPontosVantagem();salvarDados();vantagensDesvantagensPanel.style.display="none";fecharModal("salvar-vantagens-modal");calcularAtributos();};function atualizarVantagensDesvantagensPanel(){vantagensList.innerHTML="<h3>Vantagens</h3>";desvantagensList.innerHTML="<h3>Desvantagens</h3>";vantagensData.forEach(v=>{const div=document.createElement("div");div.className="vantagem-item";div.textContent=`${v.nome} - Custo: ${v.custo} PH - ${v.descricao}`;if(tempVantagensSelecionadas.includes(v.nome))div.classList.add("comprada");div.onclick=()=>{if(vantagensSelecionadas.includes(v.nome))alert("Vantagem salva, remova com permissão do GM.");else if(tempVantagensSelecionadas.includes(v.nome))tempVantagensSelecionadas=tempVantagensSelecionadas.filter(t=>t!==v.nome);else{if(v.restricao==="inicio"&&nivel>0)return alert("Apenas no nível 0.");if(calcularPontosVantagemTemp()>=v.custo)tempVantagensSelecionadas.push(v.nome);else alert("Pontos de Vantagem insuficientes!");}atualizarVantagensDesvantagensPanel();salvarVantagensBtn.style.display="block";};vantagensList.appendChild(div);});desvantagensData.forEach(d=>{const div=document.createElement("div");div.className="desvantagem-item";div.textContent=`${d.nome} - Ganho: ${d.ganho} PH - ${d.descricao}`;if(tempDesvantagensSelecionadas.includes(d.nome))div.classList.add("comprada");div.onclick=()=>{if(desvantagensSelecionadas.includes(d.nome))alert("Desvantagem salva, remova com permissão do GM.");else if(tempDesvantagensSelecionadas.includes(d.nome))tempDesvantagensSelecionadas=tempDesvantagensSelecionadas.filter(t=>t!==d.nome);else{if(tempDesvantagensSelecionadas.length<3)tempDesvantagensSelecionadas.push(d.nome);else alert("Limite de 3 desvantagens!");}atualizarVantagensDesvantagensPanel();salvarVantagensBtn.style.display="block";};desvantagensList.appendChild(div);});document.getElementById("ph-temp").textContent=calcularPontosVantagemTemp();}function removerVantagem(v){if(isFichaLocked&&!isFichaUnlocked)return abrirModalSenha();if(confirm(`Remover a vantagem "${v}"?`)){document.getElementById("senha-gm-modal").style.display="flex";document.getElementById("senha-gm-input").value="";document.getElementById("confirmar-senha-gm-btn").onclick=()=>{if(document.getElementById("senha-gm-input").value===senhaMatriz){vantagensSelecionadas=vantagensSelecionadas.filter(t=>t!==v);Array.from(vantagensListDisplay.children).find(div=>div.textContent===v)?.remove();pontosVantagemSpan.textContent=getPontosVantagem();database.ref(`fichas/${currentFichaId}/vantagens`).set(vantagensSelecionadas.join("\n"));fecharModal("senha-gm-modal");calcularAtributos();}else{alert("Senha do GM incorreta!");fecharModal("senha-gm-modal");}};}}function removerDesvantagem(d){if(isFichaLocked&&!isFichaUnlocked)return abrirModalSenha();if(confirm(`Remover a desvantagem "${d}"?`)){document.getElementById("senha-gm-modal").style.display="flex";document.getElementById("senha-gm-input").value="";document.getElementById("confirmar-senha-gm-btn").onclick=()=>{if(document.getElementById("senha-gm-input").value===senhaMatriz){desvantagensSelecionadas=desvantagensSelecionadas.filter(t=>t!==d);Array.from(desvantagensListDisplay.children).find(div=>div.textContent===d)?.remove();pontosVantagemSpan.textContent=getPontosVantagem();database.ref(`fichas/${currentFichaId}/desvantagens`).set(desvantagensSelecionadas.join("\n"));fecharModal("senha-gm-modal");calcularAtributos();}else{alert("Senha do GM incorreta!");fecharModal("senha-gm-modal");}};}}function calcularPesoTotal(){pesoTotalSpan.textContent=Array.from(inventarioSlots.querySelectorAll(".inventory-weight")).reduce((total,weight)=>total+(parseFloat(weight.value)||0),0).toFixed(1);}inventarioSlots.addEventListener("input",calcularPesoTotal);adicionarMagiaBtn.onclick=()=>{if(magiasList.children.length<20){const input=document.createElement("input");input.type="text";input.className="magia-nome";input.placeholder=`Magia/Habilidade ${magiasList.children.length+1}`;magiasList.appendChild(input);salvarDados();}else alert("Limite de 20 magias/habilidades!");};racasBtn.onclick=()=>{if(isFichaLocked&&!isFichaUnlocked)return abrirModalSenha();tempRacaSelecionada=racaSelecionada;atualizarRacasPanel();racasPanel.style.display="block";salvarRacasBtn.style.display="none";};fecharRacasBtn.onclick=()=>{racasPanel.style.display="none";};salvarRacasBtn.onclick=()=>{document.getElementById("salvar-vantagens-modal").style.display="flex";};document.getElementById("confirmar-salvar-vantagens-btn").onclick=()=>{if(tempRacaSelecionada&&tempRacaSelecionada!==racaSelecionada){const raca=racasData.find(r=>r.nome===tempRacaSelecionada);if(raca){racaSelecionada=tempRacaSelecionada;racaNomeInput.textContent=racaSelecionada.split(" (")[0];racaDescricaoInput.value=raca.vantagens.join("\n\n");pontosVantagemSpan.textContent=getPontosVantagem();salvarDados();racasPanel.style.display="none";fecharModal("salvar-vantagens-modal");}}else{vantagensSelecionadas=[...tempVantagensSelecionadas];desvantagensSelecionadas=[...tempDesvantagensSelecionadas];vantagensListDisplay.innerHTML="";desvantagensListDisplay.innerHTML="";vantagensSelecionadas.forEach(v=>{const div=document.createElement("div");div.textContent=v;div.className="list-item";div.onclick=()=>removerVantagem(v);vantagensListDisplay.appendChild(div);});desvantagensSelecionadas.forEach(d=>{const div=document.createElement("div");div.textContent=d;div.className="list-item";div.onclick=()=>removerDesvantagem(d);desvantagensListDisplay.appendChild(div);});pontosVantagemSpan.textContent=getPontosVantagem();salvarDados();vantagensDesvantagensPanel.style.display="none";fecharModal("salvar-vantagens-modal");calcularAtributos();}};function atualizarRacasPanel(){racasList.innerHTML="";racasData.forEach(r=>{const div=document.createElement("div");div.className="raca-item";div.innerHTML=`<h3>${r.nome}</h3><p>${r.descricao}</p><p><strong>Vantagens:</strong></p><ul>${r.vantagens.map(v=>`<li>${v}</li>`).join("")}</ul>`;if(tempRacaSelecionada===r.nome)div.classList.add("comprada");div.onclick=()=>{if(racaSelecionada){document.getElementById("senha-gm-modal").style.display="flex";document.getElementById("senha-gm-input").value="";document.getElementById("confirmar-senha-gm-btn").onclick=()=>{if(document.getElementById("senha-gm-input").value===senhaMatriz){tempRacaSelecionada=null;atualizarRacasPanel();salvarRacasBtn.style.display="block";fecharModal("senha-gm-modal");}else{alert("Senha do GM incorreta!");fecharModal("senha-gm-modal");}};}else if(tempRacaSelecionada===r.nome){document.getElementById("senha-gm-modal").style.display="flex";document.getElementById("senha-gm-input").value="";document.getElementById("confirmar-senha-gm-btn").onclick=()=>{if(document.getElementById("senha-gm-input").value===senhaMatriz){tempRacaSelecionada=null;atualizarRacasPanel();salvarRacasBtn.style.display="block";fecharModal("senha-gm-modal");}else{alert("Senha do GM incorreta!");fecharModal("senha-gm-modal");}};}else{if(calcularPontosVantagemTemp()>=r.custo){tempRacaSelecionada=r.nome;document.getElementById("confirmar-compra-modal").style.display="flex";document.getElementById("confirmar-compra-btn").onclick=()=>{atualizarRacasPanel();salvarRacasBtn.style.display="block";fecharModal("confirmar-compra-modal");};}else alert("Pontos de Vantagem insuficientes!");}atualizarRacasPanel();};racasList.appendChild(div);});}function excluirRaca(){if(racaSelecionada){document.getElementById("senha-gm-modal").style.display="flex";document.getElementById("senha-gm-input").value="";document.getElementById("confirmar-senha-gm-btn").onclick=()=>{if(document.getElementById("senha-gm-input").value===senhaMatriz){racaSelecionada=null;racaNomeInput.textContent="";racaDescricaoInput.value="";pontosVantagemSpan.textContent=getPontosVantagem();salvarDados();fecharModal("senha-gm-modal");}else{alert("Senha do GM incorreta!");fecharModal("senha-gm-modal");}};}}classesBtn.onclick=()=>{classesPanel.style.display="block";};fecharClassesBtn.onclick=()=>{classesPanel.style.display="none";};luaBtn.onclick=()=>{document.body.classList.add("dark-mode");};solBtn.onclick=()=>{document.body.classList.remove("dark-mode");};resetPontosButton.onclick=resetarPontos;recomecarButton.onclick=recomecarFicha;carregarFichas();</script></body></html>
