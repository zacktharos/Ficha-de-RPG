<!DOCTYPE html>
<html lang="pt-br">
<head>
    <!-- ... (o restante do head permanece igual) ... -->
    <style>
        /* Adicione estes novos estilos */
        .raca-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .botao-editar {
            background: #4CAF50;
        }
        .botao-editar:hover {
            background: #45a049;
        }
        #editar-raca-modal textarea {
            height: 150px;
        }
    </style>
</head>
<body>
    <!-- ... (o restante do body permanece igual) ... -->
    
    <!-- Adicione este novo modal para edição de raça -->
    <div id="editar-raca-modal" class="modal">
        <div class="modal-content">
            <h3>Editar Raça</h3>
            <label>Nome da Raça:</label>
            <input type="text" id="editar-raca-nome">
            <label>Descrição da Raça:</label>
            <textarea id="editar-raca-descricao"></textarea>
            <button class="confirm-btn" onclick="salvarEdicaoRaca()">Salvar</button>
            <button class="cancel-btn" onclick="fecharModal('editar-raca-modal')">Cancelar</button>
        </div>
    </div>

    <!-- Modifique a seção de raça para incluir os novos botões -->
    <section id="inventario-habilidades">
        <!-- ... (partes anteriores permanecem iguais) ... -->
        <div class="classe-raca-container">
            <label>Raça:</label>
            <div class="raca-container">
                <span id="raca-nome"></span>
                <button id="excluir-raca-btn" class="botao botao-excluir" style="display: none;">Excluir</button>
                <button id="editar-raca-btn" class="botao botao-editar" style="display: none;">Editar</button>
            </div>
            <textarea id="raca-descricao" placeholder="Descrição da Raça" class="expandable-textarea" readonly></textarea>
        </div>
    </section>

    <!-- ... (o restante do body permanece igual) ... -->

    <script>
        // Adicione estas novas variáveis
        let racaCusto = 0;

        // Modifique a função carregarFicha
        function carregarFicha(fichaId) {
            // ... (código anterior permanece igual) ...
            racaCusto = ficha.racaCusto || 0;
            // ... (restante do código permanece igual) ...
        }

        // Adicione estas novas funções
        function editarRaca() {
            const senha = prompt("Digite a senha matriz para editar a raça:");
            if (senha !== senhaMatriz) {
                alert("Senha incorreta!");
                return;
            }
            
            document.getElementById("editar-raca-nome").value = document.getElementById("raca-nome").textContent;
            document.getElementById("editar-raca-descricao").value = document.getElementById("raca-descricao").value;
            document.getElementById("editar-raca-modal").style.display = "flex";
        }

        function salvarEdicaoRaca() {
            const novoNome = document.getElementById("editar-raca-nome").value;
            const novaDescricao = document.getElementById("editar-raca-descricao").value;
            
            database.ref(`fichas/${currentFichaId}`).update({
                racaNome: novoNome,
                racaDescricao: novaDescricao
            }).then(() => {
                carregarFicha(currentFichaId);
                fecharModal('editar-raca-modal');
            });
        }

        // Modifique a função getPontosVantagem
        function getPontosVantagem() {
            let ph = nivelData[nivel].ph;
            // ... (cálculos anteriores permanecem) ...
            ph -= racaCusto; // Usa o custo armazenado em vez de procurar na lista
            return ph;
        }

        // Modifique a seleção de raças para armazenar o custo
        function atualizarRacasPanel() {
            racasList.innerHTML = "";
            racasData.forEach(r => {
                const div = document.createElement("div");
                div.className = "raca-item";
                div.innerHTML = `
                    <h3>${r.nome}</h3>
                    <p>${r.descricao}</p>
                    <p><strong>Vantagens:</strong></p>
                    <ul>${r.vantagens.map(v => `<li>${v}</li>`).join("")}</ul>
                    <button onclick="comprarRaca('${r.nome}', ${r.custo})">Comprar</button>
                `;
                if (tempRacaSelecionada === r.nome) div.classList.add("comprada");
                racasList.appendChild(div);
            });
        }

        function comprarRaca(nome, custo) {
            if (calcularPontosVantagemTemp() >= custo) {
                tempRacaSelecionada = nome;
                racaCusto = custo;
                document.getElementById("salvar-racas-btn").style.display = "block";
                atualizarRacasPanel();
            } else {
                alert("Pontos de Vantagem insuficientes!");
            }
        }

        // Atualize os listeners dos botões
        document.getElementById("excluir-raca-btn").onclick = () => {
            if (isFichaLocked && !isFichaUnlocked) return abrirModalSenha();
            if (confirm("Deseja excluir a raça selecionada?")) {
                document.getElementById("senha-gm-modal").style.display = "flex";
                document.getElementById("senha-gm-input").value = "";
                document.getElementById("confirmar-senha-gm-btn").onclick = () => {
                    if (document.getElementById("senha-gm-input").value === senhaMatriz) {
                        database.ref(`fichas/${currentFichaId}`).update({
                            racaSelecionada: "",
                            racaNome: "",
                            racaDescricao: "",
                            racaCusto: 0
                        }).then(() => {
                            carregarFicha(currentFichaId);
                            fecharModal("senha-gm-modal");
                        });
                    } else {
                        alert("Senha do GM incorreta!");
                        fecharModal("senha-gm-modal");
                    }
                };
            }
        };

        document.getElementById("editar-raca-btn").onclick = editarRaca;

        // ... (o restante do código permanece igual) ...
    </script>
</body>
</html>
