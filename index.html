<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Personagem RPG</title>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <!-- Adicionando o Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        /* Estilos personalizados para a ficha */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
            color: #000000;
            display: flex;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            background-image: url('medieval_background.jpg');
            background-size: cover;
            background-position: center;
        }

        #fichas-sidebar {
            width: 60px;
            background-color: #ffffff;
            padding: 10px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .ficha-tab {
            width: 50px;
            height: 80px;
            background-color: #f0e6d2;
            border: 2px solid #b8860b;
            border-radius: 0 10px 10px 0;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
        }

        .ficha-tab:hover {
            background-color: #a0522d;
            transform: translateX(5px);
        }

        .ficha-tab.active {
            background-color: #a0522d;
            transform: translateX(5px);
        }

        .ficha-tab span {
            font-family: 'MedievalSharp', serif;
            color: #000000;
            font-size: 0.9rem;
            text-align: center;
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #add-ficha-btn {
            width: 50px;
            height: 80px;
            background-color: #f0e6d2;
            border: 2px solid #b8860b;
            border-radius: 0 10px 10px 0;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: fixed;
            top: 10px;
            left: 0;
            transition: transform 0.2s ease;
            box-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700;
            z-index: 1001;
        }

        #add-ficha-btn span {
            font-family: 'MedievalSharp', serif;
            color: #000000;
            font-size: 0.9rem;
            text-align: center;
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #add-ficha-btn:hover {
            background-color: #a0522d;
            transform: translateX(5px);
        }

        #ficha-container {
            background-color: rgba(240, 230, 210, 0.95);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            width: 95%;
            max-width: 1200px;
            margin: 0 auto;
            margin-bottom: 20px;
            border: 2px solid #b8860b;
            position: relative;
        }

        h1#nome-personagem-titulo {
            font-family: 'MedievalSharp', serif;
            color: #1C2526;
            font-size: 3rem;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            animation: raios 2s infinite linear;
        }

        @keyframes raios {
            0% {
                text-shadow: 0 0 5px #FFD700, 0 0 10px #FFD700, 0 0 15px #FFD700, 0 0 20px #FF4500;
            }
            50% {
                text-shadow: 0 0 10px #FFD700, 0 0 15px #FFD700, 0 0 20px #FF4500, 0 0 25px #FF4500;
            }
            100% {
                text-shadow: 0 0 5px #FFD700, 0 0 10px #FFD700, 0 0 15px #FFD700, 0 0 20px #FF4500;
            }
        }

        h2 {
            font-family: 'MedievalSharp', serif;
            color: #000000;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        label {
            font-weight: 600;
            color: #000000;
            margin-bottom: 8px;
            display: block;
        }

        input[type="text"], input[type="number"], textarea {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            width: calc(100% - 20px);
            margin-bottom: 15px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            background-color: #f8f8f8;
            color: #000000;
        }

        input[type="text"]:focus, input[type="number"]:focus, textarea:focus {
            border-color: #a0522d;
            outline: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        textarea {
            resize: vertical;
            height: 100px;
            transition: height 0.3s ease;
        }

        .atributos-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .atributos-coluna {
            width: 48%;
        }

        .atributo {
            margin-bottom: 15px;
        }

        .atributo-nome {
            font-weight: 600;
            color: #000000;
        }

        .atributo-valor {
            font-weight: 400;
            color: #000000;
        }

        .armamento-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .armamento-coluna {
            width: 48%;
        }

        .inventario-container {
            margin-bottom: 20px;
        }

        .inventario-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .inventario-item label {
            margin-right: 10px;
            margin-bottom: 0;
            width: 80px;
            text-align: right;
        }

        .inventario-item input {
            flex: 1;
            margin-bottom: 0;
        }

        .vantagens-desvantagens-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .vantagens-coluna, .desvantagens-coluna {
            width: 48%;
        }

        .vantagens-coluna h3, .desvantagens-coluna h3 {
            font-size: 1.2rem;
            font-family: 'MedievalSharp', serif;
            color: #000000;
            margin-bottom: 15px;
            text-align: left;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .vantagens-coluna ul, .desvantagens-coluna ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .vantagens-coluna li, .desvantagens-coluna li {
            margin-bottom: 10px;
        }

        .botoes-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .botao {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-family: 'MedievalSharp', serif;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .botao-reset {
            background-color: #b8860b;
        }

        .botao-reset:hover {
            background-color: #a0522d;
            transform: translateY(-2px);
        }

        .botao-recomecar {
            background-color: #a52a2a;
        }

        .botao-recomecar:hover {
            background-color: #8b0000;
            transform: translateY(-2px);
        }

        .botao-bloquear, .botao-desbloquear {
            background-color: #4a4a4a;
        }

        .botao-bloquear:hover, .botao-desbloquear:hover {
            background-color: #2a2a2a;
            transform: translateY(-2px);
        }

        .botao-excluir {
            background-color: #a52a2a;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-family: 'MedievalSharp', serif;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            position: absolute;
            bottom: 20px;
            left: 20px;
        }

        .botao-excluir:hover {
            background-color: #8b0000;
            transform: translateY(-2px);
        }

        #tabela-experiencia {
            margin-top: 30px;
            border-collapse: collapse;
            width: 100%;
            background-color: rgba(240, 230, 210, 0.9);
            border: 1px solid #b8860b;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: none;
        }

        #tabela-experiencia th, #tabela-experiencia td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #b8860b;
            font-family: 'Inter', sans-serif;
            color: #000000;
        }

        #tabela-experiencia th {
            background-color: #b8860b;
            color: white;
            font-family: 'MedievalSharp', serif;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        #tabela-experiencia tr:last-child td {
            border-bottom: none;
        }

        #tabela-experiencia tr:hover {
            background-color: rgba(240, 230, 210, 0.8);
        }

        .vida-magia-vigor {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .vida-magia-vigor div {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 30%;
            min-width: 200px;
            margin-bottom: 10px;
            text-align: center;
        }

        .vida-magia-vigor div label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #000000;
        }

        .vida-magia-vigor div span {
            font-size: 1.2rem;
            font-weight: bold;
            color: #000000;
        }

        @media (max-width: 768px) {
            .atributos-container {
                flex-direction: column;
            }
            .atributos-coluna {
                width: 100%;
            }
            .armamento-container {
                flex-direction: column;
            }
            .armamento-coluna {
                width: 100%;
            }
            .vantagens-desvantagens-container {
                flex-direction: column;
            }
            .vantagens-coluna, .desvantagens-coluna {
                width: 100%;
            }
            .botoes-container {
                flex-direction: column;
            }
            .botao {
                margin: 10px 0;
                width: 100%;
                text-align: center;
            }
            .vida-magia-vigor div {
                width: 90%;
                margin-left: auto;
                margin-right: auto;
            }
            #ficha-container {
                margin-left: 0;
            }
            #fichas-sidebar {
                width: 100%;
                height: 60px;
                flex-direction: row;
                top: auto;
                bottom: 0;
                left: 0;
                overflow-x: auto;
                padding: 0 10px;
            }
            .ficha-tab, #add-ficha-btn {
                width: 80px;
                height: 50px;
                margin-bottom: 0;
                margin-right: 10px;
                border-radius: 10px 10px 0 0;
            }
            .ficha-tab span, #add-ficha-btn span {
                writing-mode: horizontal-tb;
                transform: none;
                max-width: 60px;
            }
        }

        #titulo-mestre {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: 'MedievalSharp', serif;
            color: #000000;
            text-shadow: 0 0 10px #00BFFF, 0 0 20px #00BFFF;
            font-size: 1.5rem;
            animation: brilhar 2s infinite alternate;
        }

        @keyframes brilhar {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }

        #status-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-right: 20px;
            width: 300px;
        }

        #status-container div {
            margin-bottom: 10px;
        }

        #magias-habilidades-container, #vantagens-container, #desvantagens-container {
            width: calc(100% - 340px);
            margin-left: 340px;
        }

        #magias-habilidades-container textarea, #vantagens-container textarea, #desvantagens-container textarea {
            width: calc(100% - 20px);
            min-height: 100px;
            margin-bottom: 15px;
        }

        .inventario-container textarea {
            width: calc(100% - 20px);
            min-height: 100px;
            margin-bottom: 15px;
        }

        #nivel.aura-azul {
            animation: pulsar-aura 2s infinite;
            animation-duration: 120s;
        }

        @keyframes pulsar-aura {
            0% {
                box-shadow: 0 0 5px #00BFFF, 0 0 10px #00BFFF, 0 0 15px #00BFFF;
            }
            50% {
                box-shadow: 0 0 10px #00BFFF, 0 0 20px #00BFFF, 0 0 30px #00BFFF;
            }
            100% {
                box-shadow: 0 0 5px #00BFFF, 0 0 10px #00BFFF, 0 0 15px #00BFFF;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #f0e6d2;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #b8860b;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            width: 300px;
            text-align: center;
        }

        .modal-content h3 {
            font-family: 'MedievalSharp', serif;
            color: #000000;
            margin-bottom: 15px;
        }

        .modal-content input {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        .modal-content button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-family: 'MedievalSharp', serif;
            color: white;
            cursor: pointer;
            margin: 0 5px;
        }

        .modal-content .confirm-btn {
            background-color: #b8860b;
        }

        .modal-content .confirm-btn:hover {
            background-color: #a0522d;
        }

        .modal-content .cancel-btn {
            background-color: #a52a2a;
        }

        .modal-content .cancel-btn:hover {
            background-color: #8b0000;
        }

        #password-modal .modal-content {
            border: 2px solid #a52a2a;
        }
    </style>
</head>
<body>
    <div id="fichas-sidebar">
        <div id="add-ficha-btn"><span>+ Fichas</span></div>
    </div>

    <div id="ficha-container">
        <h1 id="nome-personagem-titulo">Ficha de Personagem</h1>
        <div id="titulo-mestre" style="display: none;">Você virou o Game Master</div>

        <div id="ficha-content">
            <div class="text-center mb-4">
                <label for="nome-personagem" class="block text-gray-700 text-sm font-bold mb-2">Nome do Personagem:</label>
                <input type="text" id="nome-personagem" placeholder="Digite o nome do seu personagem" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>

            <div class="text-center mb-6">
                <label for="descricao-personagem" class="block text-gray-700 text-sm font-bold mb-2">Descrição do Personagem:</label>
                <textarea id="descricao-personagem" placeholder="Digite a descrição do seu personagem" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
            </div>

            <div class="vida-magia-vigor">
                <div>
                    <label for="vida">Pontos de Vida:</label>
                    <span id="vida">50</span>
                </div>
                <div>
                    <label for="magia">Pontos de Magia:</label>
                    <span id="magia">20</span>
                </div>
                <div>
                    <label for="vigor">Pontos de Vigor:</label>
                    <span id="vigor">10</span>
                </div>
            </div>

            <div class="atributos-container">
                <div class="atributos-coluna">
                    <div class="atributo">
                        <label for="forca" class="atributo-nome">Força:</label>
                        <input type="number" id="forca" value="0" min="0" class="atributo-valor shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <div class="atributo">
                        <label for="destreza" class="atributo-nome">Destreza:</label>
                        <input type="number" id="destreza" value="0" min="0" class="atributo-valor shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <div class="atributo">
                        <label for="agilidade" class="atributo-nome">Agilidade:</label>
                        <input type="number" id="agilidade" value="0" min="0" class="atributo-valor shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <div class="atributo">
                        <label for="constituicao" class="atributo-nome">Constituição:</label>
                        <input type="number" id="constituicao" value="0" min="0" class="atributo-valor shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <div class="atributo">
                        <label for="inteligencia" class="atributo-nome">Inteligência:</label>
                        <input type="number" id="inteligencia" value="0" min="0" class="atributo-valor shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                </div>
                <div class="atributos-coluna">
                    <div class="atributo">
                        <label for="ataque" class="atributo-nome">Ataque:</label>
                        <span id="ataque" class="atributo-valor">0</span>
                    </div>
                    <div class="atributo">
                        <label for="ataque-magico" class="atributo-nome">Ataque Mágico:</label>
                        <span id="ataque-magico" class="atributo-valor">0</span>
                    </div>
                    <div class="atributo">
                        <label for="acerto" class="atributo-nome">Acerto:</label>
                        <span id="acerto" class="atributo-valor">0</span>
                    </div>
                    <div class="atributo">
                        <label for="esquiva" class="atributo-nome">Esquiva:</label>
                        <span id="esquiva" class="atributo-valor">0</span>
                    </div>
                    <div class="atributo">
                        <label for="rdf" class="atributo-nome">RDF:</label>
                        <span id="rdf" class="atributo-valor">0</span>
                    </div>
                    <div class="atributo">
                        <label for="rdm" class="atributo-nome">RDM:</label>
                        <span id="rdm" class="atributo-valor">0</span>
                    </div>
                </div>
            </div>

            <div class="armamento-container">
                <div class="armamento-coluna">
                    <label>Armamento Mão Direita:</label>
                    <div class="flex items-center mb-2">
                        <input type="text" id="arma-direita-nome" placeholder="Nome da Arma" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mr-2">
                        <span>Ataque </span><input type="number" id="arma-direita-ataque" value="0" class="shadow appearance-none border rounded w-20 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mr-2">
                        <span>Ataque Mágico </span><input type="number" id="arma-direita-ataque-magico" value="0" class="shadow appearance-none border rounded w-20 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                </div>
                <div class="armamento-coluna">
                    <label>Armamento Mão Esquerda:</label>
                    <div class="flex items-center">
                        <input type="text" id="arma-esquerda-nome" placeholder="Nome da Arma" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mr-2">
                        <span>Ataque </span><input type="number" id="arma-esquerda-ataque" value="0" class="shadow appearance-none border rounded w-20 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mr-2">
                        <span>Ataque Mágico </span><input type="number" id="arma-esquerda-ataque-magico" value="0" class="shadow appearance-none border rounded w-20 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                </div>
            </div>

            <div style="display: flex;">
                <div id="status-container">
                    <div class="mb-4">
                        <label for="experiencia" class="block text-gray-700 text-sm font-bold mb-2">Experiência:</label>
                        <input type="number" id="experiencia" value="0" min="0" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <div>
                        <label for="nivel" class="block text-gray-700 text-sm font-bold mt-2 mb-2">Nível:</label>
                        <span id="nivel" class="shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight">0</span>
                    </div>
                    <div>
                        <label for="pontos-habilidade" class="block text-gray-700 text-sm font-bold mt-2 mb-2">Pontos de Habilidade (PD):</label>
                        <span id="pontos-habilidade" class="shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight">25</span>
                    </div>
                    <div>
                        <label for="pontos-vantagem" class="block text-gray-700 text-sm font-bold mt-2 mb-2">Pontos de Vantagem (PH):</label>
                        <span id="pontos-vantagem" class="shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight">5</span>
                    </div>
                </div>

                <!-- Reordenado: Magias e Habilidades primeiro -->
                <div id="magias-habilidades-container" class="mb-4">
                    <label for="magias-habilidades" class="block text-gray-700 text-sm font-bold mb-2">Magias e Habilidades:</label>
                    <textarea id="magias-habilidades" placeholder="Digite as magias e habilidades do seu personagem" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
                </div>
            </div>

            <!-- Vantagens em seguida -->
            <div style="display: flex;">
                <div id="vantagens-container" class="mb-4" style="margin-left: 340px;">
                    <label for="vantagens" class="block text-gray-700 text-sm font-bold mb-2">Vantagens:</label>
                    <textarea id="vantagens" placeholder="Digite as vantagens do seu personagem" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
                </div>
            </div>

            <!-- Desvantagens por último -->
            <div style="display: flex;">
                <div id="desvantagens-container" class="mb-4" style="margin-left: 340px;">
                    <label for="desvantagens" class="block text-gray-700 text-sm font-bold mb-2">Desvantagens:</label>
                    <textarea id="desvantagens" placeholder="Digite as desvantagens do seu personagem" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
                </div>
            </div>

            <div class="inventario-container">
                <h2>Inventário</h2>
                <textarea id="inventario" placeholder="Digite os itens do seu personagem" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
            </div>

            <div class="botoes-container">
                <button id="reset-pontos" class="botao botao-reset">Reiniciar Pontos</button>
                <button id="recomecar" class="botao botao-recomecar">Recomeçar</button>
                <button id="bloquear-ficha" class="botao botao-bloquear">Bloquear Ficha</button>
            </div>

            <button id="excluir-ficha" class="botao botao-excluir">Excluir Ficha</button>

            <table id="tabela-experiencia">
                <thead>
                    <tr>
                        <th>Nível</th>
                        <th>XP Acumulativo Necessário</th>
                        <th>Pontos de Habilidade (PD)</th>
                        <th>Pontos de Vantagens (PH)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>0</td><td>0</td><td>25</td><td>5</td></tr>
                    <tr><td>1</td><td>10</td><td>31</td><td>6</td></tr>
                    <tr><td>2</td><td>30</td><td>37</td><td>7</td></tr>
                    <tr><td>3</td><td>60</td><td>43</td><td>8</td></tr>
                    <tr><td>4</td><td>100</td><td>49</td><td>9</td></tr>
                    <tr><td>5</td><td>150</td><td>55</td><td>10</td></tr>
                    <tr><td>6</td><td>210</td><td>61</td><td>11</td></tr>
                    <tr><td>7</td><td>280</td><td>67</td><td>12</td></tr>
                    <tr><td>8</td><td>360</td><td>73</td><td>13</td></tr>
                    <tr><td>9</td><td>450</td><td>79</td><td>14</td></tr>
                    <tr><td>10</td><td>550</td><td>85</td><td>15</td></tr>
                    <tr><td>11</td><td>670</td><td>91</td><td>16</td></tr>
                    <tr><td>12</td><td>810</td><td>97</td><td>17</td></tr>
                    <tr><td>13</td><td>970</td><td>103</td><td>18</td></tr>
                    <tr><td>14</td><td>1150</td><td>109</td><td>19</td></tr>
                    <tr><td>15</td><td>1350</td><td>115</td><td>20</td></tr>
                    <tr><td>16</td><td>1570</td><td>121</td><td>21</td></tr>
                    <tr><td>17</td><td>1810</td><td>127</td><td>22</td></tr>
                    <tr><td>18</td><td>2070</td><td>133</td><td>23</td></tr>
                    <tr><td>19</td><td>2350</td><td>139</td><td>24</td></tr>
                    <tr><td>20</td><td>2650</td><td>145</td><td>25</td></tr>
                    <tr><td>21</td><td>2980</td><td>148</td><td>26</td></tr>
                    <tr><td>22</td><td>3340</td><td>151</td><td>27</td></tr>
                    <tr><td>23</td><td>3730</td><td>154</td><td>28</td></tr>
                    <tr><td>24</td><td>4150</td><td>157</td><td>29</td></tr>
                    <tr><td>25</td><td>4600</td><td>160</td><td>30</td></tr>
                    <tr><td>26</td><td>5080</td><td>163</td><td>31</td></tr>
                    <tr><td>27</td><td>5590</td><td>166</td><td>32</td></tr>
                    <tr><td>28</td><td>6130</td><td>169</td><td>33</td></tr>
                    <tr><td>29</td><td>8000</td><td>219</td><td>34</td></tr>
                    <tr><td>30</td><td>10000</td><td>319</td><td>35</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="nome-ficha-modal" class="modal">
        <div class="modal-content">
            <h3>Dê um Nome à Ficha</h3>
            <input type="text" id="nome-ficha-input" placeholder="Nome da ficha" maxlength="20">
            <button class="confirm-btn" onclick="criarNovaFicha()">Confirmar</button>
            <button class="cancel-btn" onclick="fecharModal('nome-ficha-modal')">Cancelar</button>
        </div>
    </div>

    <div id="bloquear-ficha-modal" class="modal">
        <div class="modal-content">
            <h3>Ponha sua Senha de 4 Dígitos</h3>
            <input type="password" id="senha-bloqueio-input" placeholder="Senha (4 dígitos)" maxlength="4">
            <button class="confirm-btn" onclick="bloquearFicha()">Confirmar</button>
            <button class="cancel-btn" onclick="fecharModal('bloquear-ficha-modal')">Cancelar</button>
        </div>
    </div>

    <div id="password-modal" class="modal">
        <div class="modal-content">
            <h3>Digite sua Senha</h3>
            <input type="password" id="senha-desbloqueio-input" placeholder="Senha (4 dígitos)" maxlength="4">
            <button class="confirm-btn" onclick="desbloquearFicha()">Confirmar</button>
            <button class="cancel-btn" onclick="fecharModal('password-modal')">Cancelar</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBbbwbwPXv6gztkyP3TXK-DtooEI7FcClI",
            authDomain: "ficha-de-rpg-b9685.firebaseapp.com",
            databaseURL: "https://ficha-de-rpg-b9685-default-rtdb.firebaseio.com",
            projectId: "ficha-de-rpg-b9685",
            storageBucket: "ficha-de-rpg-b9685.firebasestorage.app",
            messagingSenderId: "528610398062",
            appId: "1:528610398062:web:8fdb9cfd5ded8167613b7f"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let fichas = {};
        let currentFichaId = null;
        let isFichaLocked = false;
        let fichaPassword = null;
        let isFichaUnlocked = false;
        const senhaMatriz = "777";

        function criarFichaMatriz() {
            const fichaMatrizId = 'ficha-matriz';
            const fichaMatriz = {
                nomeFicha: 'Matriz',
                nomePersonagem: 'Personagem Matriz',
                descricaoPersonagem: 'Ficha original do sistema',
                forca: '0',
                destreza: '0',
                agilidade: '0',
                inteligencia: '0',
                constituicao: '0',
                experiencia: '0',
                armaDireitaNome: '',
                armaDireitaAtaque: '0',
                armaDireitaAtaqueMagico: '0',
                armaEsquerdaNome: '',
                armaEsquerdaAtaque: '0',
                armaEsquerdaAtaqueMagico: '0',
                vantagens: '',
                magiasHabilidades: '',
                desvantagens: '',
                inventario: '',
                isLocked: true,
                password: senhaMatriz
            };

            database.ref('fichas/ficha-matriz').once('value', (snapshot) => {
                if (!snapshot.exists()) {
                    database.ref(`fichas/${fichaMatrizId}`).set(fichaMatriz).then(() => {
                        currentFichaId = fichaMatrizId;
                        carregarFicha(fichaMatrizId);
                    });
                } else {
                    currentFichaId = fichaMatrizId;
                    carregarFicha(fichaMatrizId);
                    carregarFichas();
                }
            });
        }

        function carregarFichas() {
            database.ref('fichas').on('value', (snapshot) => {
                fichas = snapshot.val() || {};
                if (!fichas['ficha-matriz']) {
                    criarFichaMatriz();
                } else {
                    atualizarAbasFichas();
                }
            });
        }

        function atualizarAbasFichas() {
            const fichasSidebar = document.getElementById('fichas-sidebar');
            const addFichaBtn = document.getElementById('add-ficha-btn');
            while (fichasSidebar.children.length > 1) {
                fichasSidebar.removeChild(fichasSidebar.children[1]);
            }
            for (let fichaId in fichas) {
                if (fichaId !== 'ficha-matriz') {
                    const tab = document.createElement('div');
                    tab.className = 'ficha-tab';
                    const span = document.createElement('span');
                    span.textContent = fichas[fichaId].nomeFicha || 'Sem Nome';
                    tab.appendChild(span);
                    tab.dataset.fichaId = fichaId;
                    if (fichaId === currentFichaId) {
                        tab.classList.add('active');
                    }
                    tab.onclick = () => {
                        currentFichaId = fichaId;
                        carregarFicha(fichaId);
                        atualizarAbasFichas();
                    };
                    fichasSidebar.appendChild(tab);
                }
            }
        }

        document.getElementById('add-ficha-btn').onclick = () => {
            document.getElementById('nome-ficha-modal').style.display = 'flex';
            document.getElementById('nome-ficha-input').value = '';
            document.getElementById('nome-ficha-input').focus();
        };

        function criarNovaFicha() {
            const nomeFicha = document.getElementById('nome-ficha-input').value.trim();
            if (!nomeFicha) {
                alert('Por favor, dê um nome à ficha!');
                return;
            }

            const fichaId = database.ref('fichas').push().key;
            const novaFicha = {
                nomeFicha: nomeFicha,
                nomePersonagem: '',
                descricaoPersonagem: '',
                forca: '0',
                destreza: '0',
                agilidade: '0',
                inteligencia: '0',
                constituicao: '0',
                experiencia: '0',
                armaDireitaNome: '',
                armaDireitaAtaque: '0',
                armaDireitaAtaqueMagico: '0',
                armaEsquerdaNome: '',
                armaEsquerdaAtaque: '0',
                armaEsquerdaAtaqueMagico: '0',
                vantagens: '',
                magiasHabilidades: '',
                desvantagens: '',
                inventario: '',
                isLocked: false,
                password: null
            };

            database.ref(`fichas/${fichaId}`).set(novaFicha).then(() => {
                currentFichaId = fichaId;
                carregarFicha(fichaId);
                fecharModal('nome-ficha-modal');
            });
        }

        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        const nomePersonagemInput = document.getElementById('nome-personagem');
        const descricaoPersonagemInput = document.getElementById('descricao-personagem');
        const forcaInput = document.getElementById('forca');
        const destrezaInput = document.getElementById('destreza');
        const agilidadeInput = document.getElementById('agilidade');
        const inteligenciaInput = document.getElementById('inteligencia');
        const constituicaoInput = document.getElementById('constituicao');
        const ataqueSpan = document.getElementById('ataque');
        const ataqueMagicoSpan = document.getElementById('ataque-magico');
        const acertoSpan = document.getElementById('acerto');
        const esquivaSpan = document.getElementById('esquiva');
        const rdfSpan = document.getElementById('rdf');
        const rdmSpan = document.getElementById('rdm');
        const vidaSpan = document.getElementById('vida');
        const magiaSpan = document.getElementById('magia');
        const vigorSpan = document.getElementById('vigor');
        const armaDireitaNomeInput = document.getElementById('arma-direita-nome');
        const armaDireitaAtaqueInput = document.getElementById('arma-direita-ataque');
        const armaDireitaAtaqueMagicoInput = document.getElementById('arma-direita-ataque-magico');
        const armaEsquerdaNomeInput = document.getElementById('arma-esquerda-nome');
        const armaEsquerdaAtaqueInput = document.getElementById('arma-esquerda-ataque');
        const armaEsquerdaAtaqueMagicoInput = document.getElementById('arma-esquerda-ataque-magico');
        const resetPontosButton = document.getElementById('reset-pontos');
        const recomecarButton = document.getElementById('recomecar');
        const bloquearFichaButton = document.getElementById('bloquear-ficha');
        const experienciaInput = document.getElementById('experiencia');
        const nivelSpan = document.getElementById('nivel');
        const pontosHabilidadeSpan = document.getElementById('pontos-habilidade');
        const pontosVantagemSpan = document.getElementById('pontos-vantagem');
        const tabelaExperiencia = document.getElementById('tabela-experiencia');
        const nomePersonagemTitulo = document.getElementById('nome-personagem-titulo');
        const tituloMestre = document.getElementById('titulo-mestre');
        const vantagensInput = document.getElementById('vantagens');
        const magiasHabilidadesInput = document.getElementById('magias-habilidades');
        const desvantagensInput = document.getElementById('desvantagens');
        const inventarioInput = document.getElementById('inventario');

        const atributosInputs = [forcaInput, destrezaInput, agilidadeInput, inteligenciaInput, constituicaoInput];

        let nivel = 0;
        let nivelAnterior = 0;
        let pontosHabilidadeTotal = 25;
        let pontosHabilidadeUsados = 0;
        let pontosVantagem = 5;
        let experiencia = 0;
        let vidaBase = 50;

        const nivelData = [
            { nivel: 0, xp: 0, pd: 25, ph: 5 },
            { nivel: 1, xp: 10, pd: 31, ph: 6 },
            { nivel: 2, xp: 30, pd: 37, ph: 7 },
            { nivel: 3, xp: 60, pd: 43, ph: 8 },
            { nivel: 4, xp: 100, pd: 49, ph: 9 },
            { nivel: 5, xp: 150, pd: 55, ph: 10 },
            { nivel: 6, xp: 210, pd: 61, ph: 11 },
            { nivel: 7, xp: 280, pd: 67, ph: 12 },
            { nivel: 8, xp: 360, pd: 73, ph: 13 },
            { nivel: 9, xp: 450, pd: 79, ph: 14 },
            { nivel: 10, xp: 550, pd: 85, ph: 15 },
            { nivel: 11, xp: 670, pd: 91, ph: 16 },
            { nivel: 12, xp: 810, pd: 97, ph: 17 },
            { nivel: 13, xp: 970, pd: 103, ph: 18 },
            { nivel: 14, xp: 1150, pd: 109, ph: 19 },
            { nivel: 15, xp: 1350, pd: 115, ph: 20 },
            { nivel: 16, xp: 1570, pd: 121, ph: 21 },
            { nivel: 17, xp: 1810, pd: 127, ph: 22 },
            { nivel: 18, xp: 2070, pd: 133, ph: 23 },
            { nivel: 19, xp: 2350, pd: 139, ph: 24 },
            { nivel: 20, xp: 2650, pd: 145, ph: 25 },
            { nivel: 21, xp: 2980, pd: 148, ph: 26 },
            { nivel: 22, xp: 3340, pd: 151, ph: 27 },
            { nivel: 23, xp: 3730, pd: 154, ph: 28 },
            { nivel: 24, xp: 4150, pd: 157, ph: 29 },
            { nivel: 25, xp: 4600, pd: 160, ph: 30 },
            { nivel: 26, xp: 5080, pd: 163, ph: 31 },
            { nivel: 27, xp: 5590, pd: 166, ph: 32 },
            { nivel: 28, xp: 6130, pd: 169, ph: 33 },
            { nivel: 29, xp: 8000, pd: 219, ph: 34 },
            { nivel: 30, xp: 10000, pd: 319, ph: 35 }
        ];

        function carregarFicha(fichaId) {
            if (!fichas[fichaId]) return;

            const ficha = fichas[fichaId];
            nomePersonagemInput.value = ficha.nomePersonagem || '';
            descricaoPersonagemInput.value = ficha.descricaoPersonagem || '';
            forcaInput.value = ficha.forca || '0';
            destrezaInput.value = ficha.destreza || '0';
            agilidadeInput.value = ficha.agilidade || '0';
            inteligenciaInput.value = ficha.inteligencia || '0';
            constituicaoInput.value = ficha.constituicao || '0';
            experienciaInput.value = ficha.experiencia || '0';
            armaDireitaNomeInput.value = ficha.armaDireitaNome || '';
            armaDireitaAtaqueInput.value = ficha.armaDireitaAtaque || '0';
            armaDireitaAtaqueMagicoInput.value = ficha.armaDireitaAtaqueMagico || '0';
            armaEsquerdaNomeInput.value = ficha.armaEsquerdaNome || '';
            armaEsquerdaAtaqueInput.value = ficha.armaEsquerdaAtaque || '0';
            armaEsquerdaAtaqueMagicoInput.value = ficha.armaEsquerdaAtaqueMagico || '0';
            vantagensInput.value = ficha.vantagens || '';
            magiasHabilidadesInput.value = ficha.magiasHabilidades || '';
            desvantagensInput.value = ficha.desvantagens || '';
            inventarioInput.value = ficha.inventario || '';
            isFichaLocked = ficha.isLocked || false;
            fichaPassword = ficha.password || null;
            isFichaUnlocked = false;

            atualizarBotaoBloquear();

            experiencia = parseInt(experienciaInput.value) || 0;
            atualizarNivel();
            calcularAtributos();
        }

        function atualizarBotaoBloquear() {
            if (isFichaLocked) {
                bloquearFichaButton.textContent = 'Desbloquear Ficha';
                bloquearFichaButton.classList.remove('botao-bloquear');
                bloquearFichaButton.classList.add('botao-desbloquear');
            } else {
                bloquearFichaButton.textContent = 'Bloquear Ficha';
                bloquearFichaButton.classList.remove('botao-desbloquear');
                bloquearFichaButton.classList.add('botao-bloquear');
            }
        }

        function salvarDados() {
            if (!currentFichaId) return;
            if (isFichaLocked && !isFichaUnlocked) {
                abrirModalSenha();
                return;
            }

            const updates = {
                nomePersonagem: nomePersonagemInput.value,
                descricaoPersonagem: descricaoPersonagemInput.value,
                forca: forcaInput.value,
                destreza: destrezaInput.value,
                agilidade: agilidadeInput.value,
                inteligencia: inteligenciaInput.value,
                constituicao: constituicaoInput.value,
                experiencia: experienciaInput.value,
                armaDireitaNome: armaDireitaNomeInput.value,
                armaDireitaAtaque: armaDireitaAtaqueInput.value,
                armaDireitaAtaqueMagico: armaDireitaAtaqueMagicoInput.value,
                armaEsquerdaNome: armaEsquerdaNomeInput.value,
                armaEsquerdaAtaque: armaEsquerdaAtaqueInput.value,
                armaEsquerdaAtaqueMagico: armaEsquerdaAtaqueMagicoInput.value,
                vantagens: vantagensInput.value,
                magiasHabilidades: magiasHabilidadesInput.value,
                desvantagens: desvantagensInput.value,
                inventario: inventarioInput.value
            };

            database.ref(`fichas/${currentFichaId}`).update(updates);
        }

        function calcularNivel(xp) {
            let novoNivel = 0;
            for (let i = 0; i < nivelData.length; i++) {
                if (xp >= nivelData[i].xp) {
                    novoNivel = nivelData[i].nivel;
                } else {
                    break;
                }
            }
            return novoNivel;
        }

        function atualizarNivel() {
            nivelAnterior = nivel;
            nivel = calcularNivel(experiencia);
            nivelSpan.textContent = nivel;
            pontosHabilidadeTotal = nivelData[nivel].pd;
            pontosVantagem = nivelData[nivel].ph;
            pontosVantagemSpan.textContent = pontosVantagem;

            if (nivel > nivelAnterior) {
                nivelSpan.classList.remove('aura-azul');
                nivelSpan.classList.add('aura-azul');
            }

            calcularAtributos();
            if (nivel >= 30) {
                nomePersonagemTitulo.style.color = '#FFD700';
                tituloMestre.style.display = 'block';
            } else {
                nomePersonagemTitulo.style.color = '#1C2526';
                tituloMestre.style.display = 'none';
            }
        }

        function calcularAtributos() {
            let forca = parseInt(forcaInput.value) || 0;
            let destreza = parseInt(destrezaInput.value) || 0;
            let agilidade = parseInt(agilidadeInput.value) || 0;
            let inteligencia = parseInt(inteligenciaInput.value) || 0;
            let constituicao = parseInt(constituicaoInput.value) || 0;

            let pontosUsados = forca + destreza + agilidade + inteligencia + constituicao;

            if (pontosUsados > pontosHabilidadeTotal) {
                alert('Você não tem pontos de habilidade suficientes! Reduzindo os atributos para o limite disponível.');
                let excedente = pontosUsados - pontosHabilidadeTotal;
                while (excedente > 0) {
                    if (inteligencia > 0) {
                        inteligencia--;
                        excedente--;
                        inteligenciaInput.value = inteligencia;
                    }
                    if (excedente > 0 && constituicao > 0) {
                        constituicao--;
                        excedente--;
                        constituicaoInput.value = constituicao;
                    }
                    if (excedente > 0 && agilidade > 0) {
                        agilidade--;
                        excedente--;
                        agilidadeInput.value = agilidade;
                    }
                    if (excedente > 0 && destreza > 0) {
                        destreza--;
                        excedente--;
                        destrezaInput.value = destreza;
                    }
                    if (excedente > 0 && forca > 0) {
                        forca--;
                        excedente--;
                        forcaInput.value = forca;
                    }
                }
                pontosUsados = pontosHabilidadeTotal;
            }

            pontosHabilidadeUsados = pontosUsados;
            pontosHabilidadeSpan.textContent = pontosHabilidadeTotal - pontosHabilidadeUsados;

            let ataque = forca + Math.floor(destreza / 5);
            let acerto = Math.floor(destreza / 3) + Math.floor(agilidade / 10);
            let esquiva = Math.floor(agilidade / 3);
            let rdf = Math.floor(forca / 5);
            let rdm = Math.floor(inteligencia / 5);
            let ataqueMagico = inteligencia;

            let magiaBase = 20 + constituicao * 3;
            let vigorBase = 10 + constituicao * 0.4;

            vidaBase = 50 + (constituicao * (3 + Math.floor(forca / 10))) + (nivel * 10);

            if (inteligencia >= 10) {
                magiaBase += constituicao * Math.floor(inteligencia / 10);
            }

            let ataqueArmaDireita = parseInt(armaDireitaAtaqueInput.value) || 0;
            let ataqueArmaEsquerda = parseInt(armaEsquerdaAtaqueInput.value) || 0;
            let ataqueMagicoArmaDireita = parseInt(armaDireitaAtaqueMagicoInput.value) || 0;
            let ataqueMagicoArmaEsquerda = parseInt(armaEsquerdaAtaqueMagicoInput.value) || 0;

            ataque += ataqueArmaDireita + ataqueArmaEsquerda;
            ataqueMagico += ataqueMagicoArmaDireita + ataqueMagicoArmaEsquerda;

            ataqueSpan.textContent = ataque;
            ataqueMagicoSpan.textContent = ataqueMagico;
            acertoSpan.textContent = acerto;
            esquivaSpan.textContent = esquiva;
            rdfSpan.textContent = rdf;
            rdmSpan.textContent = rdm;
            vidaSpan.textContent = Math.ceil(vidaBase);
            magiaSpan.textContent = Math.ceil(magiaBase);
            vigorSpan.textContent = vigorBase.toFixed(1);
        }

        function validarDesvantagens() {
            const desvantagensText = desvantagensInput.value.trim();
            if (desvantagensText === '') {
                alert('Você deve ter pelo menos 1 desvantagem!');
                return false;
            }
            const desvantagens = desvantagensText.split('\n').filter(d => d.trim() !== '');
            if (desvantagens.length < 1) {
                alert('Você deve ter pelo menos 1 desvantagem!');
                return false;
            }
            if (desvantagens.length > 3) {
                alert('Você pode ter no máximo 3 desvantagens!');
                return false;
            }
            return true;
        }

        function resetarPontos() {
            if (isFichaLocked && !isFichaUnlocked) {
                abrirModalSenha();
                return;
            }

            atributosInputs.forEach(input => {
                input.value = 0;
            });
            pontosHabilidadeUsados = 0;
            pontosHabilidadeSpan.textContent = pontosHabilidadeTotal;
            pontosVantagem = nivelData[nivel].ph;
            pontosVantagemSpan.textContent = pontosVantagem;
            calcularAtributos();
            salvarDados();
        }

        function recomecarFicha() {
            if (isFichaLocked && !isFichaUnlocked) {
                abrirModalSenha();
                return;
            }

            resetarPontos();
            nomePersonagemInput.value = '';
            descricaoPersonagemInput.value = '';
            experienciaInput.value = 0;
            nivel = 0;
            pontosHabilidadeTotal = nivelData[nivel].pd;
            pontosHabilidadeUsados = 0;
            pontosVantagem = nivelData[nivel].ph;
            nivelSpan.textContent = nivel;
            pontosHabilidadeSpan.textContent = pontosHabilidadeTotal;
            pontosVantagemSpan.textContent = pontosVantagem;
            nomePersonagemTitulo.style.color = '#1C2526';
            tituloMestre.style.display = 'none';
            vidaBase = 50;
            armaDireitaNomeInput.value = '';
            armaDireitaAtaqueInput.value = '0';
            armaDireitaAtaqueMagicoInput.value = '0';
            armaEsquerdaNomeInput.value = '';
            armaEsquerdaAtaqueInput.value = '0';
            armaEsquerdaAtaqueMagicoInput.value = '0';
            vantagensInput.value = '';
            magiasHabilidadesInput.value = '';
            desvantagensInput.value = '';
            inventarioInput.value = '';
            calcularAtributos();
            salvarDados();
        }

        function expandirTextarea(textarea) {
            textarea.style.height = '300px'; // Triplo do tamanho original (100px -> 300px)
        }

        function minimizarTextarea(textarea) {
            textarea.style.height = '100px';
        }

        bloquearFichaButton.onclick = () => {
            if (isFichaLocked) {
                abrirModalSenha();
            } else {
                document.getElementById('bloquear-ficha-modal').style.display = 'flex';
                document.getElementById('senha-bloqueio-input').value = '';
                document.getElementById('senha-bloqueio-input').focus();
            }
        };

        function bloquearFicha() {
            const senha = document.getElementById('senha-bloqueio-input').value;
            if (senha.length !== 4 || !/^\d{4}$/.test(senha)) {
                alert('A senha deve ter exatamente 4 dígitos numéricos!');
                return;
            }

            isFichaLocked = true;
            fichaPassword = senha;
            database.ref(`fichas/${currentFichaId}`).update({
                isLocked: true,
                password: senha
            }).then(() => {
                fecharModal('bloquear-ficha-modal');
                alert('Ficha bloqueada com sucesso!');
                atualizarBotaoBloquear();
            });
        }

        function abrirModalSenha() {
            document.getElementById('password-modal').style.display = 'flex';
            document.getElementById('senha-desbloqueio-input').value = '';
            document.getElementById('senha-desbloqueio-input').focus();
        }

        function desbloquearFicha() {
            const senha = document.getElementById('senha-desbloqueio-input').value;
            if (senha === senhaMatriz) {
                isFichaUnlocked = true;
                if (currentFichaId !== 'ficha-matriz') {
                    isFichaLocked = false;
                    fichaPassword = null;
                    database.ref(`fichas/${currentFichaId}`).update({
                        isLocked: false,
                        password: null
                    });
                }
                fecharModal('password-modal');
                alert('Ficha desbloqueada com a senha matriz!');
                atualizarBotaoBloquear();
                salvarDados();
            } else if (senha === fichaPassword) {
                isFichaUnlocked = true;
                isFichaLocked = false;
                fichaPassword = null;
                database.ref(`fichas/${currentFichaId}`).update({
                    isLocked: false,
                    password: null
                }).then(() => {
                    fecharModal('password-modal');
                    alert('Ficha desbloqueada com sucesso!');
                    atualizarBotaoBloquear();
                    salvarDados();
                });
            } else {
                alert('Senha incorreta!');
            }
        }

        document.getElementById('excluir-ficha').addEventListener('click', () => {
            if (currentFichaId === 'ficha-matriz') {
                alert('A ficha matriz não pode ser excluída!');
                return;
            }

            if (isFichaLocked && !isFichaUnlocked) {
                abrirModalSenha();
                return;
            }

            if (confirm(`Tem certeza que deseja excluir a ficha "${fichas[currentFichaId].nomeFicha}"?`)) {
                database.ref(`fichas/${currentFichaId}`).remove().then(() => {
                    currentFichaId = 'ficha-matriz';
                    carregarFicha('ficha-matriz');
                    atualizarAbasFichas();
                    alert('Ficha excluída com sucesso!');
                });
            }
        });

        nomePersonagemInput.addEventListener('input', salvarDados);
        descricaoPersonagemInput.addEventListener('input', salvarDados);
        forcaInput.addEventListener('input', () => { calcularAtributos(); salvarDados(); });
        destrezaInput.addEventListener('input', () => { calcularAtributos(); salvarDados(); });
        agilidadeInput.addEventListener('input', () => { calcularAtributos(); salvarDados(); });
        inteligenciaInput.addEventListener('input', () => { calcularAtributos(); salvarDados(); });
        constituicaoInput.addEventListener('input', () => { calcularAtributos(); salvarDados(); });
        experienciaInput.addEventListener('input', () => {
            experiencia = parseInt(experienciaInput.value) || 0;
            atualizarNivel();
            calcularAtributos();
            salvarDados();
        });
        armaDireitaNomeInput.addEventListener('input', salvarDados);
        armaDireitaAtaqueInput.addEventListener('input', () => { calcularAtributos(); salvarDados(); });
        armaDireitaAtaqueMagicoInput.addEventListener('input', () => { calcularAtributos(); salvarDados(); });
        armaEsquerdaNomeInput.addEventListener('input', salvarDados);
        armaEsquerdaAtaqueInput.addEventListener('input', () => { calcularAtributos(); salvarDados(); });
        armaEsquerdaAtaqueMagicoInput.addEventListener('input', () => { calcularAtributos(); salvarDados(); });
        vantagensInput.addEventListener('input', salvarDados);
        magiasHabilidadesInput.addEventListener('input', salvarDados);
        desvantagensInput.addEventListener('input', salvarDados);
        inventarioInput.addEventListener('input', salvarDados);

        vantagensInput.addEventListener('focus', () => expandirTextarea(vantagensInput));
        vantagensInput.addEventListener('blur', () => minimizarTextarea(vantagensInput));

        magiasHabilidadesInput.addEventListener('focus', () => expandirTextarea(magiasHabilidadesInput));
        magiasHabilidadesInput.addEventListener('blur', () => minimizarTextarea(magiasHabilidadesInput));

        desvantagensInput.addEventListener('focus', () => expandirTextarea(desvantagensInput));
        desvantagensInput.addEventListener('blur', () => {
            minimizarTextarea(desvantagensInput);
            validarDesvantagens();
        });

        inventarioInput.addEventListener('focus', () => expandirTextarea(inventarioInput));
        inventarioInput.addEventListener('blur', () => minimizarTextarea(inventarioInput));

        resetPontosButton.addEventListener('click', resetarPontos);
        recomecarButton.addEventListener('click', recomecarFicha);

        criarFichaMatriz();
    </script>
</body>
</html>
