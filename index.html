<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Personagem RPG</title>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
            color: #000000;
            display: flex;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            background-image: url('medieval_background.jpg');
            background-size: cover;
            background-position: center;
        }
        #fichas-sidebar {
            width: 100%;
            height: 60px;
            background-color: #ffffff;
            padding: 10px 0;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-start;
            position: fixed;
            top: 0;
            left: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            overflow-x: auto;
        }
        .ficha-tab {
            width: 100px;
            height: 50px;
            background-color: #f0e6d2;
            border: 2px solid #b8860b;
            border-radius: 10px 10px 0 0;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
        }
        .ficha-tab:hover {
            background-color: #a0522d;
            transform: translateY(-5px);
        }
        .ficha-tab.active {
            background-color: #a0522d;
            transform: translateY(-5px);
        }
        .ficha-tab span {
            font-family: 'MedievalSharp', serif;
            color: #000000;
            font-size: 0.9rem;
            text-align: center;
            max-width: 90px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        #add-ficha-btn {
            width: 100px;
            height: 50px;
            background-color: #f0e6d2;
            border: 2px solid #b8860b;
            border-radius: 10px 10px 0 0;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s ease;
            box-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700;
            z-index: 1001;
        }
        #add-ficha-btn span {
            font-family: 'MedievalSharp', serif;
            color: #000000;
            font-size: 0.9rem;
        }
        #add-ficha-btn:hover {
            background-color: #a0522d;
            transform: translateY(-5px);
        }
        #ficha-container {
            background-color: rgba(240, 230, 210, 0.95);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            width: 95%;
            max-width: 1200px;
            margin: 80px auto 20px auto;
            border: 2px solid #b8860b;
            position: relative;
        }
        #ficha-container.aura-azul {
            box-shadow: 0 0 30px 15px #00BFFF;
            animation: pulsar-aura 2s infinite;
        }
        @keyframes pulsar-aura {
            0% { box-shadow: 0 0 20px #00BFFF, 0 0 30px #00BFFF, 0 0 40px #00BFFF; }
            50% { box-shadow: 0 0 30px #00BFFF, 0 0 50px #00BFFF, 0 0 60px #00BFFF; }
            100% { box-shadow: 0 0 20px #00BFFF, 0 0 30px #00BFFF, 0 0 40px #00BFFF; }
        }
        h1#nome-personagem-titulo {
            font-family: 'MedievalSharp', serif;
            color: #1C2526;
            font-size: 3rem;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            animation: raios 2s infinite linear;
        }
        @keyframes raios {
            0% { text-shadow: 0 0 5px #FFD700, 0 0 10px #FFD700, 0 0 15px #FFD700, 0 0 20px #FF4500; }
            50% { text-shadow: 0 0 10px #FFD700, 0 0 15px #FFD700, 0 0 20px #FF4500, 0 0 25px #FF4500; }
            100% { text-shadow: 0 0 5px #FFD700, 0 0 10px #FFD700, 0 0 15px #FFD700, 0 0 20px #FF4500; }
        }
        #game-master-message {
            display: none;
            color: blue;
            font-size: 1.5rem;
            text-align: center;
            font-family: 'MedievalSharp', serif;
            margin-bottom: 10px;
        }
        section {
            background-color: #f0e6d2;
            border: 2px solid #b8860b;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        section h2 {
            font-family: 'MedievalSharp', serif;
            color: #a0522d;
            font-size: 1.5rem;
            margin-bottom: 10px;
            text-align: center;
        }
        label {
            font-weight: 600;
            color: #000000;
            margin-bottom: 8px;
            display: block;
        }
        input[type="text"], input[type="number"], textarea {
            padding: 10px;
            border: 2px solid #b8860b;
            border-radius: 6px;
            width: calc(100% - 24px);
            margin-bottom: 15px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            background-color: #fff;
            color: #000000;
        }
        input[type="text"]:focus, input[type="number"]:focus, textarea:focus {
            border-color: #a0522d;
            outline: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        input[readonly], span[readonly] {
            background-color: #e8e8e8;
            border: 1px solid #ccc;
            cursor: not-allowed;
        }
        textarea {
            resize: vertical;
            height: 100px;
        }
        .atributos-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .atributos-coluna, .atributos-coluna-destaque {
            width: 48%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .atributos-coluna-destaque {
            background-color: #ffffff;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #b8860b;
        }
        .atributo-destaque {
            padding: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        .atributo-destaque label {
            font-size: 1.1rem;
            font-weight: 700;
            color: #a0522d;
        }
        .atributo-destaque span {
            font-size: 1.2rem;
            font-family: 'MedievalSharp', serif;
            color: #000000;
        }
        .atributo-fogo {
            animation: fogo 1.5s infinite;
        }
        @keyframes fogo {
            0% { text-shadow: 0 0 5px #ff4500, 0 0 10px #ff4500, 0 0 15px #ff4500, 0 0 20px #ff4500; }
            50% { text-shadow: 0 0 10px #ff4500, 0 0 15px #ff4500, 0 0 20px #ff4500, 0 0 25px #ff4500; }
            100% { text-shadow: 0 0 5px #ff4500, 0 0 10px #ff4500, 0 0 15px #ff4500, 0 0 20px #ff4500; }
        }
        .locomotion-container {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            background-color: #f0e6d2;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #b8860b;
        }
        .locomotion-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .locomotion-item span {
            font-size: 1.5rem;
            font-family: 'MedievalSharp', serif;
            color: #000000;
        }
        .vantagens-desvantagens-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .vantagens-coluna, .desvantagens-coluna {
            width: 48%;
            display: flex;
            flex-direction: column;
        }
        .vantagem-item, .desvantagem-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .vantagem-item input[type="checkbox"], .desvantagem-item input[type="checkbox"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }
        .vantagem-item label, .desvantagem-item label {
            font-weight: 600;
            color: #000000;
        }
        #vantagens-desvantagens-panel {
            position: fixed;
            top: 80px;
            right: -300px;
            width: 300px;
            height: calc(100vh - 120px);
            background-color: #f0e6d2;
            border: 2px solid #b8860b;
            border-radius: 10px 0 0 10px;
            padding: 20px;
            box-shadow: -5px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease-in-out;
            overflow-y: auto;
            z-index: 1000;
        }
        #vantagens-desvantagens-panel.show {
            right: 0;
        }
        #vantagens-desvantagens-panel h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-align: center;
        }
        #vantagens-desvantagens-panel ul {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }
        #vantagens-desvantagens-panel li {
            margin-bottom: 10px;
        }
        #vantagens-desvantagens-panel button {
            background-color: #a0522d;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-family: 'MedievalSharp', serif;
            font-size: 1rem;
            width: 100%;
        }
        #vantagens-desvantagens-panel button:hover {
            background-color: #8b4513;
        }
        #vantagens-desvantagens-btn {
            position: absolute;
            bottom: 20px;
            left: -140px;
            background-color: #a0522d;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 0 10px 10px 0;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-family: 'MedievalSharp', serif;
            font-size: 1rem;
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.3);
        }
        #vantagens-desvantagens-btn:hover {
            background-color: #8b4513;
            transform: translateX(5px);
        }
        #anotacoes-btn {
            position: absolute;
            bottom: 80px;
            left: -140px;
            background-color: #a0522d;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 0 10px 10px 0;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-family: 'MedievalSharp', serif;
            font-size: 1rem;
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.3);
        }
        #anotacoes-btn:hover {
            background-color: #8b4513;
            transform: translateX(5px);
        }
        #anotacoes-container {
            position: absolute;
            top: 80px;
            left: -105px;
            width: 100px;
            height: 100px;
            background-color: #f0e6d2;
            border: 2px solid #b8860b;
            border-radius: 10px;
            padding: 10px;
            box-shadow: -5px 0 10px rgba(0, 0, 0, 0.1);
            transition: width 0.3s ease, height 0.3s ease, left 0.3s ease;
            z-index: 1000;
            overflow: hidden;
        }
        #anotacoes-container.expandido {
            width: 300px;
            height: 200px;
            left: -305px;
        }
        #anotacoes-container textarea {
            width: calc(100% - 20px);
            height: calc(100% - 20px);
            border: none;
            resize: none;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            background-color: #fff;
            color: #000000;
        }
        #status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        #nivel-container {
            display: flex;
            align-items: center;
        }
        #nivel-container span {
            margin-left: 5px;
            font-size: 1.2rem;
            font-family: 'MedievalSharp', serif;
            color: #000000;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        .modal-content {
            background-color: #f0e6d2;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #b8860b;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .modal-content h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        .modal-content input {
            padding: 10px;
            border: 1px solid #b8860b;
            border-radius: 5px;
            width: calc(100% - 20px);
            margin-bottom: 15px;
            font-size: 1rem;
        }
        .modal-content button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-family: 'MedievalSharp', serif;
            font-size: 1rem;
            margin: 5px;
        }
        .modal-content button.confirmar {
            background-color: #a0522d;
            color: #fff;
        }
        .modal-content button.confirmar:hover {
            background-color: #8b4513;
        }
        .modal-content button.cancelar {
            background-color: #ccc;
            color: #000000;
        }
        .modal-content button.cancelar:hover {
            background-color: #aaa;
        }
        #rolar-dados-btn {
            background-color: #a0522d;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-family: 'MedievalSharp', serif;
            font-size: 1rem;
            margin-top: 10px;
            width: 100%;
        }
        #rolar-dados-btn:hover {
            background-color: #8b4513;
        }
        #resultado-rolagem {
            margin-top: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            color: #000000;
        }
        #notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 10000;
            display: none;
            font-family: 'MedievalSharp', serif;
            font-size: 1rem;
        }
        #notification.success {
            background-color: rgba(0, 255, 0, 0.7);
        }
        #notification.error {
            background-color: rgba(255, 0, 0, 0.7);
        }
        @media (max-width: 768px) {
            #fichas-sidebar {
                overflow-x: auto;
            }
            .ficha-tab {
                width: auto;
                padding: 10px 15px;
                margin-right: 5px;
            }
            .ficha-tab span {
                font-size: 0.8rem;
            }
            #add-ficha-btn {
                width: auto;
                padding: 10px 15px;
                margin-right: 5px;
            }
            #ficha-container {
                width: 98%;
                margin-left: auto;
                margin-right: auto;
            }
            .atributos-container {
                flex-direction: column;
            }
            .atributos-coluna, .atributos-coluna-destaque {
                width: 100%;
            }
            .vantagens-desvantagens-container {
                flex-direction: column;
            }
            .vantagens-coluna, .desvantagens-coluna {
                width: 100%;
            }
            #vantagens-desvantagens-panel {
                width: 95%;
                max-width: 100%;
                top: auto;
                bottom: 0;
                left: 0;
                border-radius: 10px 10px 0 0;
                height: auto;
                max-height: 300px;
                overflow-y: auto;
                right: 0;
            }
            #vantagens-desvantagens-panel.show {
                transform: translateY(0);
            }
            #vantagens-desvantagens-btn {
                bottom: auto;
                top: 20px;
                left: 10px;
                border-radius: 10px 0 0 10px;
            }
            #anotacoes-btn {
                bottom: auto;
                top: 80px;
                left: 10px;border-radius: 10px 0 0 10px;
            }
            #anotacoes-container {
                top: 140px;
                left: 10px;
            }
            #anotacoes-container.expandido {
                left: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="fichas-sidebar">
    </div>
    <button id="add-ficha-btn"><span>Nova Ficha</span></button>
    <div id="ficha-container" class="aura-azul" style="display: none;">
        <h1 id="nome-personagem-titulo">Nome do Personagem</h1>
        <div id="game-master-message"></div>
        <section id="status">
            <h2>Status</h2>
            <div id="nivel-container">
                <span>Nível:</span><span id="nivel">1</span>
            </div>
            <div>
                <label for="experiencia">Experiência:</label>
                <input type="number" id="experiencia" value="0">
            </div>
            <div>
                <label for="pontos-de-vida">Pontos de Vida (PD):</label>
                <input type="number" id="pontos-de-vida" value="50">
            </div>
            <div>
                <label for="pontos-de-magia">Pontos de Magia (PM):</label>
                <input type="number" id="pontos-de-magia" value="30">
            </div>
            <div>
                <label for="pontos-de-vigor">Pontos de Vigor (PV):</label>
                <input type="number" id="pontos-de-vigor" value="40">
            </div>
        </section>
        <section id="atributos">
            <h2>Atributos</h2>
            <div class="atributos-container">
                <div class="atributos-coluna">
                    <div>
                        <label for="forca">Força:</label>
                        <input type="number" id="forca" value="10">
                    </div>
                    <div>
                        <label for="agilidade">Agilidade:</label>
                        <input type="number" id="agilidade" value="10">
                    </div>
                    <div>
                        <label for="inteligencia">Inteligência:</label>
                        <input type="number" id="inteligencia" value="10">
                    </div>
                    <div>
                        <label for="constituicao">Constituição:</label>
                        <input type="number" id="constituicao" value="10">
                    </div>
                </div>
                <div class="atributos-coluna-destaque">
                    <div class="atributo-destaque">
                        <label>Ataque:</label>
                        <span id="ataque" class="atributo-fogo">10</span>
                    </div>
                    <div class="atributo-destaque">
                        <label>Defesa:</label>
                        <span id="defesa">10</span>
                    </div>
                    <div class="atributo-destaque">
                        <label>Poder de Fogo:</label>
                        <span id="poder-de-fogo" class="atributo-fogo">10</span>
                    </div>
                </div>
            </div>
        </section>
        <section id="locomocao">
            <h2>Locomoção</h2>
            <div class="locomotion-container">
                <div class="locomotion-item">
                    <span>Velocidade de Corrida:</span>
                    <span id="velocidade-corrida">25 km/h</span>
                </div>
                <div class="locomotion-item">
                    <span>Altura do Pulo:</span>
                    <span id="altura-pulo">1 m</span>
                </div>
                <div class="locomotion-item">
                    <span>Distância do Pulo:</span>
                    <span id="distancia-pulo">3 m</span>
                </div>
            </div>
        </section>
        <section id="inventario">
            <h2>Inventário</h2>
            <div id="inventario-slots">
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Item" class="inventory-name">
                    <input type="number" min="0" value="0" class="inventory-weight" title="Peso (kg)">
                </div>
            </div>
            <div>
                <span>Peso Total: <span id="peso-total">0.0</span> kg</span>
            </div>
        </section>
        <section id="magias">
            <h2>Magias</h2>
            <div id="magias-list">
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <div class="inventory-slot">
                    <input type="text" placeholder="Nome da Magia" class="magia-nome">
                    <input type="number" min="0" value="0" class="magia-custo" title="Custo de Mana">
                </div>
                <button id="add-magia-btn">Adicionar Magia</button>
            </div>
        </section>
        <section class="vantagens-desvantagens">
            <h2>Vantagens e Desvantagens</h2>
            <div class="vantagens-desvantagens-container">
                <div class="vantagens-coluna">
                    <h3>Vantagens</h3>
                    <div class="vantagem-item">
                        <input type="checkbox" id="vantagem1" data-ph="1">
                        <label for="vantagem1">Vantagem 1 (+1 PH)</label>
                    </div>
                    <div class="vantagem-item">
                        <input type="checkbox" id="vantagem2" data-ph="2">
                        <label for="vantagem2">Vantagem 2 (+2 PH)</label>
                    </div>
                    <div class="vantagem-item">
                        <input type="checkbox" id="vantagem3" data-ph="3">
                        <label for="vantagem3">Vantagem 3 (+3 PH)</label>
                    </div>
                    <div class="vantagem-item">
                        <input type="checkbox" id="vantagem4" data-ph="1">
                        <label for="vantagem4">Vantagem 4 (+1 PH)</label>
                    </div>
                    <div class="vantagem-item">
                        <input type="checkbox" id="vantagem5" data-ph="2">
                        <label for="vantagem5">Vantagem 5 (+2 PH)</label>
                    </div>
                </div>
                <div class="desvantagens-coluna">
                    <h3>Desvantagens</h3>
                    <div class="desvantagem-item">
                        <input type="checkbox" id="desvantagem1" data-ph="-1">
                        <label for="desvantagem1">Desvantagem 1 (-1 PH)</label>
                    </div>
                    <div class="desvantagem-item">
                        <input type="checkbox" id="desvantagem2" data-ph="-2">
                        <label for="desvantagem2">Desvantagem 2 (-2 PH)</label>
                    </div>
                    <div class="desvantagem-item">
                        <input type="checkbox" id="desvantagem3" data-ph="-3">
                        <label for="desvantagem3">Desvantagem 3 (-3 PH)</label>
                    </div>
                    <div class="desvantagem-item">
                        <input type="checkbox" id="desvantagem4" data-ph="-1">
                        <label for="desvantagem4">Desvantagem 4 (-1 PH)</label>
                    </div>
                    <div class="desvantagem-item">
                        <input type="checkbox" id="desvantagem5" data-ph="-2">
                        <label for="desvantagem5">Desvantagem 5 (-2 PH)</label>
                    </div>
                </div>
            </div>
            <div>
                <span>Pontos de Habilidade (PH): <span id="pontos-de-habilidade">0</span></span>
            </div>
        </section>
        <button id="salvar-ficha-btn">Salvar Ficha</button>
        <button id="resetar-ficha-btn">Resetar Ficha</button>
        <button id="recomecar-ficha-btn">Recomeçar Ficha</button>
        <button id="bloquear-ficha-btn">Bloquear Ficha</button>
         <button id="excluir-ficha-btn">Excluir Ficha</button>
        <button id="rolar-dados-btn">Rolar Dados (1d6)</button>
        <div id="resultado-rolagem"></div>
    </div>
    <button id="vantagens-desvantagens-btn">Vantagens e Desvantagens</button>
    <div id="vantagens-desvantagens-panel">
        <h2>Vantagens e Desvantagens</h2>
        <ul>
            <li>
                <input type="checkbox" id="vantagem-lista-1" data-ph="1">
                <label for="vantagem-lista-1">Vantagem 1 (+1 PH)</label>
            </li>
            <li>
                <input type="checkbox" id="vantagem-lista-2" data-ph="2">
                <label for="vantagem-lista-2">Vantagem 2 (+2 PH)</label>
            </li>
             <li>
                <input type="checkbox" id="vantagem-lista-3" data-ph="3">
                <label for="vantagem-lista-3">Vantagem 3 (+3 PH)</label>
            </li>
            <li>
                <input type="checkbox" id="desvantagem-lista-1" data-ph="-1">
                <label for="desvantagem-lista-1">Desvantagem 1 (-1 PH)</label>
            </li>
            <li>
                <input type="checkbox" id="desvantagem-lista-2" data-ph="-2">
                <label for="desvantagem-lista-2">Desvantagem 2 (-2 PH)</label>
            </li>
            <li>
                <input type="checkbox" id="desvantagem-lista-3" data-ph="-3">
                <label for="desvantagem-lista-3">Desvantagem 3 (-3 PH)</label>
            </li>
        </ul>
        <button id="salvar-vantagens-btn">Salvar</button>
    </div>
    <button id="anotacoes-btn">Anotações</button>
    <div id="anotacoes-container">
        <textarea placeholder="Digite suas anotações aqui..."></textarea>
    </div>
    <div id="password-modal" class="modal">
        <div class="modal-content">
            <h2>Confirmação de Senha</h2>
            <input type="password" id="password-input" placeholder="Digite a senha">
            <button id="password-confirm" class="confirmar">Confirmar</button>
            <button id="password-cancel" class="cancelar">Cancelar</button>
        </div>
    </div>
    <div id="senha-gm-modal" class="modal">
        <div class="modal-content">
            <h2>Senha do Mestre</h2>
            <input type="password" id="senha-gm-input" placeholder="Digite a senha do Mestre">
            <button id="senha-gm-confirmar" class="confirmar">Confirmar</button>
            <button id="senha-gm-cancelar" class="cancelar">Cancelar</button>
        </div>
    </div>
    <div id="notification"></div>
    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "your-auth-domain.firebaseapp.com",
            databaseURL: "https://your-database-url.firebaseio.com",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket.appspot.com",
            messagingSenderId: "your-messaging-sender-id",
            appId: "your-app-id"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        let fichas = {};
        let currentFichaId = null;
        let isFichaLocked = false;
        let isFichaUnlocked = false;
        let senhaGM = "1234";
        let vantagensSelecionadas = {};
        let acaoPendente = null;
        const fichaContainer = document.getElementById('ficha-container');
        const fichasSidebar = document.getElementById('fichas-sidebar');
        const addFichaBtn = document.getElementById('add-ficha-btn');
        const nomePersonagemTitulo = document.getElementById('nome-personagem-titulo');
        const gameMasterMessage = document.getElementById('game-master-message');
        const nivelSpan = document.getElementById('nivel');
        const experienciaInput = document.getElementById('experiencia');
        const pontosDeVidaInput = document.getElementById('pontos-de-vida');
        const pontosDeMagiaInput = document.getElementById('pontos-de-magia');
        const pontosDeVigorInput = document.getElementById('pontos-de-vigor');
        const forcaInput = document.getElementById('forca');
        const agilidadeInput = document.getElementById('agilidade');
        const inteligenciaInput = document.getElementById('inteligencia');
        const constituicaoInput = document.getElementById('constituicao');
        const ataqueSpan = document.getElementById('ataque');
        const defesaSpan = document.getElementById('defesa');
        const poderDeFogoSpan = document.getElementById('poder-de-fogo');
        const velocidadeCorridaSpan = document.getElementById('velocidade-corrida');
        const alturaPuloSpan = document.getElementById('altura-pulo');
        const distanciaPuloSpan = document.getElementById('distancia-pulo');
        const inventarioSlots = document.getElementById('inventario-slots');
        const pesoTotalSpan = document.getElementById('peso-total');
        const magiasList = document.getElementById('magias-list');
        const addMagiaBtn = document.getElementById('add-magia-btn');
        const salvarFichaBtn = document.getElementById('salvar-ficha-btn');
        const resetarFichaBtn = document.getElementById('resetar-ficha-btn');
        const recomecarFichaBtn = document.getElementById('recomecar-ficha-btn');
        const bloquearFichaBtn = document.getElementById('bloquear-ficha-btn');
        const excluirFichaBtn = document.getElementById('excluir-ficha-btn');
        const vantagensDesvantagensBtn = document.getElementById('vantagens-desvantagens-btn');
        const vantagensDesvantagensPanel = document.getElementById('vantagens-desvantagens-panel');
        const salvarVantagensBtn = document.getElementById('salvar-vantagens-btn');
        const pontosDeHabilidadeSpan = document.getElementById('pontos-de-habilidade');
        const passwordModal = document.getElementById('password-modal');
        const passwordInput = document.getElementById('password-input');
        const passwordConfirmBtn = document.getElementById('password-confirm');
        const passwordCancelBtn = document.getElementById('password-cancel');
        const senhaGMModal = document.getElementById('senha-gm-modal');
        const senhaGMInput = document.getElementById('senha-gm-input');
        const senhaGMConfirmarBtn = document.getElementById('senha-gm-confirmar');
        const senhaGMCancelarBtn = document.getElementById('senha-gm-cancelar');
        const rolarDadosBtn = document.getElementById('rolar-dados-btn');
        const resultadoRolagem = document.getElementById('resultado-rolagem');
        const anotacoesBtn = document.getElementById('anotacoes-btn');
        const anotacoesContainer = document.getElementById('anotacoes-container');
        const anotacoesTextarea = anotacoesContainer.querySelector('textarea');
        let tempVantagensSelecionadas = {};
        function calcularAtributos() {
            const forca = parseInt(forcaInput.value) || 0;
            const agilidade = parseInt(agilidadeInput.value) || 0;
            const inteligencia = parseInt(inteligenciaInput.value) || 0;
            const constituicao = parseInt(constituicaoInput.value) || 0;
            ataqueSpan.textContent = forca + agilidade;
            defesaSpan.textContent = agilidade + constituicao;
            poderDeFogoSpan.textContent = inteligencia;
            velocidadeCorridaSpan.textContent = `${20 + agilidade * 5} km/h`;
            alturaPuloSpan.textContent = `${Math.min(1 + Math.floor(agilidade / 5), 3)} m`;
            let distanciaPulo = 3;
            if (forca >= 5 && agilidade >= 5) {
                distanciaPulo += Math.floor(Math.min(forca, agilidade) / 5) * 3;
            }
            distanciaPuloSpan.textContent = `${distanciaPulo} m`;
        }
        function calcularPesoTotal() {
            const weights = inventarioSlots.querySelectorAll('.inventory-weight');
            let total = 0;
            weights.forEach(weight => total += parseFloat(weight.value) || 0);
            pesoTotalSpan.textContent = total.toFixed(1);
        }
        function showNotification(message, className) {
            notification.textContent = message;
            notification.classList.add(className);
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
                notification.classList.remove(className);
            }, 2000);
        }
        function criarFichaMatriz(fichaId, fichaData) {
            if (!fichaData) {
                fichaData = {
                    nome: 'Nova Ficha',
                    nivel: 1,
                    experiencia: 0,
                    pontosDeVida: 50,
                    pontosDeMagia: 30,
                    pontosDeVigor: 40,
                    forca: 10,
                    agilidade: 10,
                    inteligencia: 10,
                    constituicao: 10,
                    inventario: Array(12).fill({ nome: '', peso: 0 }),
                    magias: Array(12).fill({ nome: '', custo: 0 }),
                    vantagens: {},
                    desvantagens: {},
                    anotacoes: ''
                };
            }
            fichas[fichaId] = fichaData;
            const fichaTab = document.createElement('div');
            fichaTab.className = 'ficha-tab';
            fichaTab.dataset.fichaId = fichaId;
            fichaTab.innerHTML = `<span>${fichaData.nome}</span>`;
            fichasSidebar.appendChild(fichaTab);
            fichaTab.addEventListener('click', () => {
                carregarFicha(fichaId);
                Array.from(fichasSidebar.children).forEach(tab => tab.classList.remove('active'));
                fichaTab.classList.add('active');
            });
            if (!currentFichaId) {
                carregarFicha(fichaId);
                fichaTab.classList.add('active');
            }
        }
        function carregarFicha(fichaId) {
            currentFichaId = fichaId;
            const fichaData = fichas[fichaId];
            nomePersonagemTitulo.textContent = fichaData.nome;
            if (fichaData.nivel > 5) {
                fichaContainer.classList.add('aura-azul');
            } else {
                fichaContainer.classList.remove('aura-azul');
            }
            nivelSpan.textContent = fichaData.nivel;
            experienciaInput.value = fichaData.experiencia;
            pontosDeVidaInput.value = fichaData.pontosDeVida;
            pontosDeMagiaInput.value = fichaData.pontosDeMagia;
            pontosDeVigorInput.value = fichaData.pontosDeVigor;
            forcaInput.value = fichaData.forca;
            agilidadeInput.value = fichaData.agilidade;
            inteligenciaInput.value = fichaData.inteligencia;
            constituicaoInput.value = fichaData.constituicao;
            anotacoesTextarea.value = fichaData.anotacoes;
            calcularAtributos();
            inventarioSlots.querySelectorAll('.inventory-name').forEach((input, index) => {
                input.value = fichaData.inventario[index]?.nome || '';
            });
            inventarioSlots.querySelectorAll('.inventory-weight').forEach((input, index) => {
                input.value = fichaData.inventario[index]?.peso || 0;
            });
            calcularPesoTotal();
            magiasList.querySelectorAll('.magia-nome').forEach((input, index) => {
                input.value = fichaData.magias[index]?.nome || '';
            });
            magiasList.querySelectorAll('.magia-custo').forEach((input, index) => {
                input.value = fichaData.magias[index]?.custo || 0;
            });
            Object.keys(vantagensSelecionadas).forEach(key => {
                const checkbox = document.getElementById(key);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
             Object.keys(tempVantagensSelecionadas).forEach(key => {
                const checkbox = document.getElementById(key);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
            atualizarPontosDeHabilidade();
            fichaContainer.style.display = 'block';
            isFichaLocked = fichaData.fichaLocked || false;
            isFichaUnlocked = fichaData.isFichaUnlocked || false;
            bloquearFichaBtn.textContent = isFichaLocked ? 'Desbloquear Ficha' : 'Bloquear Ficha';
            if (isFichaLocked) {
                gameMasterMessage.style.display = 'block';
            } else {
                gameMasterMessage.style.display = 'none';
            }
            forcaInput.readOnly = isFichaLocked;
            agilidadeInput.readOnly = isFichaLocked;
            inteligenciaInput.readOnly = isFichaLocked;
            constituicaoInput.readOnly = isFichaLocked;
            pontosDeVidaInput.readOnly = isFichaLocked;
            pontosDeMagiaInput.readOnly = isFichaLocked;
            pontosDeVigorInput.readOnly = isFichaLocked;
            Array.from(inventarioSlots.querySelectorAll('input')).forEach(input => {
                input.readOnly = isFichaLocked;
            });
            Array.from(magiasList.querySelectorAll('input')).forEach(input => {
                input.readOnly = isFichaLocked;
            });
            salvarFichaBtn.disabled = isFichaLocked;
            resetarFichaBtn.disabled = isFichaLocked;
            recomecarFichaBtn.disabled = isFichaLocked;
            if (isFichaLocked) {
                showNotification('Ficha Bloqueada! Desbloqueie para editar.', 'error');
            }
        }
        function salvarFicha(fichaId) {
            if (isFichaLocked && !isFichaUnlocked) {
                showNotification('Ficha está bloqueada. Desbloqueie para salvar.', 'error');
                return;
            }
            const fichaData = {
                nome: nomePersonagemTitulo.textContent,
                nivel: parseInt(nivelSpan.textContent) || 1,
                experiencia: parseInt(experienciaInput.value) || 0,
                pontosDeVida: parseInt(pontosDeVidaInput.value) || 0,
                pontosDeMagia: parseInt(pontosDeMagiaInput.value) || 0,
                pontosDeVigor: parseInt(pontosDeVigorInput.value) || 0,
                forca: parseInt(forcaInput.value) || 0,
                agilidade: parseInt(agilidadeInput.value) || 0,
                inteligencia: parseInt(inteligenciaInput.value) || 0,
                constituicao: parseInt(constituicaoInput.value) || 0,
                inventario: Array.from(inventarioSlots.querySelectorAll('.inventory-slot')).map(slot => ({
                    nome: slot.querySelector('.inventory-name').value,
                    peso: parseFloat(slot.querySelector('.inventory-weight').value) || 0
                })),
                magias: Array.from(magiasList.querySelectorAll('.inventory-slot')).map(slot => ({
                    nome: slot.querySelector('.magia-nome').value,
                    custo: parseInt(slot.querySelector('.magia-custo').value) || 0
                })),
                vantagens: vantagensSelecionadas,
                desvantagens: {},
                anotacoes: anotacoesTextarea.value,
                fichaLocked: isFichaLocked,
                isFichaUnlocked: isFichaUnlocked
            };
            database.ref(`fichas/${fichaId}`).update(fichaData)
                .then(() => {
                    fichas[fichaId] = fichaData;
                    showNotification('Ficha salva com sucesso!', 'success');
                     Array.from(fichasSidebar.children).forEach(tab => tab.remove());
                      for (const id in fichas) {
                        criarFichaMatriz(id, fichas[id]);
                    }
                })
                .catch(error => showNotification(`Erro ao salvar ficha: ${error.message}`, 'error'));
        }
        function resetarFicha() {
            if (isFichaLocked && !isFichaUnlocked) {
                showNotification('Ficha está bloqueada. Desbloqueie para resetar.', 'error');
                return;
            }
            if (confirm('Deseja resetar a ficha para os valores iniciais?')) {
                const fichaData = {
                    nome: 'Nova Ficha',
                    nivel: 1,
                    experiencia: 0,
                    pontosDeVida: 50,
                    pontosDeMagia: 30,
                    pontosDeVigor: 40,
                    forca: 10,
                    agilidade: 10,
                    inteligencia: 10,
                    constituicao: 10,
                     inventario: Array(12).fill({ nome: '', peso: 0 }),
                    magias: Array(12).fill({ nome: '', custo: 0 }),
                    vantagens: {},
                    desvantagens: {},
                    anotacoes: '',
                    fichaLocked: false,
                    isFichaUnlocked: false
                };
                fichas[currentFichaId] = fichaData;
                database.ref(`fichas/${currentFichaId}`).set(fichaData)
                    .then(() => {
                        carregarFicha(currentFichaId);
                        showNotification('Ficha resetada com sucesso!', 'success');
                    })
                    .catch(error => showNotification(`Erro ao resetar ficha: ${error.message}`, 'error'));
            }
        }
        function recomecarFicha() {
            if (isFichaLocked && !isFichaUnlocked) {
                 showNotification('Ficha está bloqueada. Desbloqueie para recomeçar.', 'error');
                return;
            }
            if (confirm('Deseja recomeçar a ficha? Todos os dados serão perdidos.')) {
                database.ref(`fichas/${currentFichaId}`).remove()
                    .then(() => {
                        delete fichas[currentFichaId];
                        currentFichaId = null;
                        fichaContainer.style.display = 'none';
                         Array.from(fichasSidebar.children).forEach(tab => tab.remove());
                        showNotification('Ficha removida com sucesso!', 'success');
                    })
                    .catch(error => showNotification(`Erro ao remover ficha: ${error.message}`, 'error'));
            }
        }
        function bloquearFicha() {
            if (isFichaLocked) {
                isFichaUnlocked = false;
                isFichaLocked = false;
                bloquearFichaBtn.textContent = 'Bloquear Ficha';
                gameMasterMessage.style.display = 'none';
                forcaInput.readOnly = false;
                agilidadeInput.readOnly = false;
                inteligenciaInput.readOnly = false;
                constituicaoInput.readOnly = false;
                pontosDeVidaInput.readOnly = false;
                pontosDeMagiaInput.readOnly = false;
                pontosDeVigorInput.readOnly = false;
                Array.from(inventarioSlots.querySelectorAll('input')).forEach(input => {
                    input.readOnly = false;
                });
                 Array.from(magiasList.querySelectorAll('input')).forEach(input => {
                    input.readOnly = false;
                });
                salvarFichaBtn.disabled = false;
                resetarFichaBtn.disabled = false;
                recomecarFichaBtn.disabled = false;
                database.ref(`fichas/${currentFichaId}`).update({ fichaLocked: false, isFichaUnlocked: false });
                showNotification('Ficha desbloqueada!', 'success');
            } else {
                passwordInput.value = '';
                passwordModal.style.display = 'flex';
                acaoPendente = 'bloquear';
            }
        }
        function desbloquearFicha() {
            const senhaDigitada = passwordInput.value;
            if (senhaDigitada === "1234") {
                isFichaLocked = true;
                isFichaUnlocked = true;
                bloquearFichaBtn.textContent = 'Desbloquear Ficha';
                gameMasterMessage.style.display = 'block';
                forcaInput.readOnly = true;
                agilidadeInput.readOnly = true;
                inteligenciaInput.readOnly = true;
                constituicaoInput.readOnly = true;
                pontosDeVidaInput.readOnly = true;
                pontosDeMagiaInput.readOnly = true;
                pontosDeVigorInput.readOnly = true;
                Array.from(inventarioSlots.querySelectorAll('input')).forEach(input => {
                    input.readOnly = true;
                });
                Array.from(magiasList.querySelectorAll('input')).forEach(input => {
                    input.readOnly = true;
                });
                salvarFichaBtn.disabled = true;
                resetarFichaBtn.disabled = true;
                recomecarFichaBtn.disabled = true;
                database.ref(`fichas/${currentFichaId}`).update({ fichaLocked: true, isFichaUnlocked: true });
                passwordModal.style.display = 'none';
                showNotification('Ficha bloqueada!', 'success');
            } else {
                showNotification('Senha incorreta!', 'error');
            }
        }
        function excluirFicha() {
            if (isFichaLocked && !isFichaUnlocked) {
                passwordInput.value = '';
                passwordModal.style.display = 'flex';
                acaoPendente = 'excluir';
            } else {
                confirmarExclusao();
            }
        }
        function confirmarExclusao() {
             if (confirm('Deseja excluir esta ficha permanentemente?')) {
                database.ref(`fichas/${currentFichaId}`).remove()
                    .then(() => {
                        delete fichas[currentFichaId];
                        currentFichaId = null;
                        fichaContainer.style.display = 'none';
                        Array.from(fichasSidebar.children).forEach(tab => tab.remove());
                        showNotification('Ficha excluída com sucesso!', 'success');
                    })
                    .catch(error => showNotification(`Erro ao excluir ficha: ${error.message}`, 'error'));
            }
        }
        function rolarDados() {
            const resultado = Math.floor(Math.random() * 6) + 1;
            resultadoRolagem.textContent = `Resultado: ${resultado}`;
            setTimeout(() => resultadoRolagem.textContent = '', 3000);
        }
        function atualizarPontosDeHabilidade() {
            let totalPH = 0;
            const vantagens = document.querySelectorAll('.vantagens-coluna input[type="checkbox"]');
            const desvantagens = document.querySelectorAll('.desvantagens-coluna input[type="checkbox"]');
            vantagens.forEach(item => {
                if (item.checked) {
                    totalPH += parseInt(item.dataset.ph) || 0;
                }
            });
            desvantagens.forEach(item => {
                if (item.checked) {
                    totalPH += parseInt(item.dataset.ph) || 0;
                }
            });
            pontosDeHabilidadeSpan.textContent = totalPH;
        }
        function atualizarVantagensDesvantagensPanel() {
            const listaVantagens = vantagensDesvantagensPanel.querySelectorAll('input[type="checkbox"]');
             tempVantagensSelecionadas = { ...vantagensSelecionadas };
            listaVantagens.forEach(item => {
                if (vantagensSelecionadas[item.id]) {
                    item.checked = true;
                    item.disabled = true;
                } else {
                    item.checked = false;
                    item.disabled = false;
                }
                item.addEventListener('change', (event) => {
                    if (vantagensSelecionadas[event.target.id]) {
                        senhaGMInput.value = '';
                        senhaGMModal.style.display = 'flex';
                        acaoPendente = 'removerVantagem';
                        acaoPendenteId = event.target.id;
                        event.target.checked = true;
                    } else {
                         if (event.target.checked) {
                            tempVantagensSelecionadas[event.target.id] = true;
                        } else {
                            delete tempVantagensSelecionadas[event.target.id];
                        }
                        atualizarPontosDeHabilidade();
                    }
                });
            });
        }
        function removerVantagemComSenhaGM() {
            const senhaDigitada = senhaGMInput.value;
            if (senhaDigitada === senhaGM) {
                delete vantagensSelecionadas[acaoPendenteId];
                delete tempVantagensSelecionadas[acaoPendenteId];
                const checkbox = document.getElementById(acaoPendenteId);
                if (checkbox) {
                    checkbox.checked = false;
                    checkbox.disabled = false;
                }
                atualizarPontosDeHabilidade();
                senhaGMModal.style.display = 'none';
                showNotification('Vantagem removida com sucesso!', 'success');
            } else {
                showNotification('Senha do Mestre incorreta!', 'error');
            }
        }
        addFichaBtn.addEventListener('click', () => {
            const novaFichaId = `ficha-${Date.now()}`;
            criarFichaMatriz(novaFichaId);
            database.ref(`fichas/${novaFichaId}`).set({
                nome: 'Nova Ficha',
                nivel: 1,
                experiencia: 0,
                pontosDeVida: 50,
                pontosDeMagia: 30,
                pontosDeVigor: 40,
                forca: 10,
                agilidade: 10,
                inteligencia: 10,
                constituicao: 10,
                inventario: Array(12).fill({ nome: '', peso: 0 }),
                magias: Array(12).fill({ nome: '', custo: 0 }),
                vantagens: {},
                desvantagens: {},
                anotacoes: ''
            });
        });
        salvarFichaBtn.addEventListener('click', () => salvarFicha(currentFichaId));
        resetarFichaBtn.addEventListener('click', resetarFicha);
        recomecarFichaBtn.addEventListener('click', recomecarFicha);
        bloquearFichaBtn.addEventListener('click', bloquearFicha);
        excluirFichaBtn.addEventListener('click', excluirFicha);
        passwordConfirmBtn.addEventListener('click', () => {
            if (acaoPendente === 'bloquear') {
                desbloquearFicha();
            } else if (acaoPendente === 'excluir') {
                confirmarExclusao();
                passwordModal.style.display = 'none';
            }  else if (acaoPendente === 'removerVantagem') {
                removerVantagemComSenhaGM();
            }
             else {
                showNotification('Ação pendente desconhecida.', 'error');
            }
        });
        passwordCancelBtn.addEventListener('click', () => passwordModal.style.display = 'none');
        senhaGMConfirmarBtn.addEventListener('click', removerVantagemComSenhaGM);
        senhaGMCancelarBtn.addEventListener('click', () => senhaGMModal.style.display = 'none');
        rolarDadosBtn.addEventListener('click', rolarDados);
        addMagiaBtn.addEventListener('click', () => {
            addMagiaSlot();
        });
        anotacoesBtn.addEventListener('click', () => {
            anotacoesContainer.classList.toggle('expandido');
            if (!anotacoesContainer.classList.contains('expandido')) {
                fichas[currentFichaId].anotacoes = anotacoesTextarea.value;
                database.ref(`fichas/${currentFichaId}`).update({ anotacoes: anotacoesTextarea.value });
            }
        });
        anotacoesTextarea.addEventListener('blur', () => {
            fichas[currentFichaId].anotacoes = anotacoesTextarea.value;
             database.ref(`fichas/${currentFichaId}`).update({ anotacoes: anotacoesTextarea.value });
        });
        forcaInput.addEventListener('input', () => {
             if (!isFichaLocked || isFichaUnlocked) {
                calcularAtributos();
             } else {
                passwordInput.value = '';
                passwordModal.style.display = 'flex';
                acaoPendente = 'alterarForca';
                acaoPendenteValor = forcaInput.value
             }
        });
        agilidadeInput.addEventListener('input', () => {
            if (!isFichaLocked || isFichaUnlocked) {
                calcularAtributos();
            } else {
                passwordInput.value = '';
                passwordModal.style.display = 'flex';
                acaoPendente = 'alterarAgilidade';
                acaoPendenteValor = agilidadeInput.value;
            }
        });
        inteligenciaInput.addEventListener('input', () => {
            if (!isFichaLocked || isFichaUnlocked) {
                calcularAtributos();
            } else {
                passwordInput.value = '';
                passwordModal.style.display = 'flex';
                acaoPendente = 'alterarInteligencia';
                acaoPendenteValor = inteligenciaInput.value;
            }
        });
        constituicaoInput.addEventListener('input', () => {
            if (!isFichaLocked || isFichaUnlocked) {
                calcularAtributos();
            } else {
                passwordInput.value = '';
                passwordModal.style.display = 'flex';
                acaoPendente = 'alterarConstituicao';
                 acaoPendenteValor = constituicaoInput.value;
            }
        });
        pontosDeVidaInput.addEventListener('input', () => {
             if (!isFichaLocked || isFichaUnlocked) {
                  fichas[currentFichaId].pontosDeVida = parseInt(pontosDeVidaInput.value) || 0;
             } else {
                passwordInput.value = '';
                passwordModal.style.display = 'flex';
                acaoPendente = 'alterarPontosDeVida';
                acaoPendenteValor = pontosDeVidaInput.value;
             }
        });
        pontosDeMagiaInput.addEventListener('input', () => {
            if (!isFichaLocked || isFichaUnlocked) {
                fichas[currentFichaId].pontosDeMagia = parseInt(pontosDeMagiaInput.value) || 0;
            } else {
                passwordInput.value = '';
                passwordModal.style.display = 'flex';
                acaoPendente = 'alterarPontosDeMagia';
                acaoPendenteValor = pontosDeMagiaInput.value;
            }
        });
        pontosDeVigorInput.addEventListener('input', () => {
            if (!isFichaLocked || isFichaUnlocked) {
                 fichas[currentFichaId].pontosDeVigor = parseInt(pontosDeVigorInput.value) || 0;
            } else {
                passwordInput.value = '';
                passwordModal.style.display = 'flex';
                acaoPendente = 'alterarPontosDeVigor';
                acaoPendenteValor = pontosDeVigorInput.value;
            }
        });
        passwordConfirmBtn.addEventListener('click', () => {
            const senhaDigitada = passwordInput.value;
            if (senhaDigitada === "1234") {
                isFichaUnlocked = true;
                passwordModal.style.display = 'none';
                switch (acaoPendente) {
                    case 'alterarForca':
                        forcaInput.value = acaoPendenteValor;
                        fichas[currentFichaId].forca = parseInt(acaoPendenteValor) || 0;
                        calcularAtributos();
                        break;
                    case 'alterarAgilidade':
                        agilidadeInput.value = acaoPendenteValor;
                        fichas[currentFichaId].agilidade = parseInt(acaoPendenteValor) || 0;
                        calcularAtributos();
                        break;
                    case 'alterarInteligencia':
                        inteligenciaInput.value = acaoPendenteValor;
                        fichas[currentFichaId].inteligencia = parseInt(acaoPendenteValor) || 0;
                        calcularAtributos();
                        break;
                    case 'alterarConstituicao':
                        constituicaoInput.value = acaoPendenteValor;
                        fichas[currentFichaId].constituicao = parseInt(acaoPendenteValor) || 0;
                        calcularAtributos();
                        break;
                     case 'alterarPontosDeVida':
                        pontosDeVidaInput.value = acaoPendenteValor;
                        fichas[currentFichaId].pontosDeVida = parseInt(acaoPendenteValor) || 0;
                        break;
                    case 'alterarPontosDeMagia':
                         pontosDeMagiaInput.value = acaoPendenteValor;
                         fichas[currentFichaId].pontosDeMagia = parseInt(acaoPendenteValor) || 0;
                         break;
                    case 'alterarPontosDeVigor':
                        pontosDeVigorInput.value = acaoPendenteValor;
                        fichas[currentFichaId].pontosDeVigor = parseInt(acaoPendenteValor) || 0;
                        break;
                    case 'bloquear':
                        desbloquearFicha();
                        break;
                    case 'excluir':
                        confirmarExclusao();
                        break;
                    default:
                        showNotification('Ação pendente desconhecida.', 'error');
                }
                acaoPendente = null;
                acaoPendenteValor = null;
            } else {
                showNotification('Senha incorreta!', 'error');
                passwordInput.value = '';
            }
        });
        window.onload = function () {
            database.ref('fichas').once('value')
                .then(snapshot => {
                    snapshot.forEach(childSnapshot => {
                        const fichaId = childSnapshot.key;
                        const fichaData = childSnapshot.val();
                        criarFichaMatriz(fichaId, fichaData);
                    });
                     if (Object.keys(fichas).length > 0) {
                        const firstFichaId = Object.keys(fichas)[0];
                        carregarFicha(firstFichaId);
                    } else {
                        const novaFichaId = `ficha-${Date.now()}`;
                        criarFichaMatriz(novaFichaId);
                        database.ref(`fichas/${novaFichaId}`).set({
                            nome: 'Nova Ficha',
                            nivel: 1,
                            experiencia: 0,
                            pontosDeVida: 50,
                            pontosDeMagia: 30,
                            pontosDeVigor: 40,
                            forca: 10,
                            agilidade: 10,
                            inteligencia: 10,
                            constituicao: 10,
                            inventario: Array(12).fill({ nome: '', peso: 0 }),
                            magias: Array(12).fill({ nome: '', custo: 0 }),
                            vantagens: {},
                            desvantagens: {},
                            anotacoes: ''
                        });
                    }
                })
                .catch(error => showNotification(`Erro ao carregar fichas: ${error.message}`, 'error'));
                atualizarVantagensDesvantagensPanel();
        };
    </script>
</body>
</html>
